# ?? 立绘面板显示指南 v1.6.26

## 问题说明

当前状态：
- ? 代码正确（FullBodyPortraitPanel.cs 存在）
- ? DLL 已部署（今天编译的版本）
- ? **游戏内设置未勾选**（ModSettings.xml 不存在）

---

## ?? 快速解决方案

### 步骤 1：在游戏中开启立绘模式

```
1. 启动 RimWorld
2. 进入游戏（加载存档或开始新游戏）
3. 按 ESC 键
4. 选择"选项"
5. 选择"Mod设置"
6. 找到"The Second Seat"
7. 勾选【使用立绘模式（1024x1572 全身立绘）】
8. ?? 重要：点击【应用】按钮
9. 返回游戏
```

### 步骤 2：观察立绘面板

立绘面板位置：
```
┌──────────────────────────────────────────────────────────┐
│                                                          │
│  [立绘面板]                                               │
│  左侧固定                                                 │
│  358×551                                                 │
│                                                          │
│                                                          │
│                                                          │
│                                                          │
│                                                          │
│                                                          │
│                                            [AI按钮128×128]│
└──────────────────────────────────────────────────────────┘
```

---

## ?? 验证是否成功

### 方法 1：开启 DevMode 查看日志

1. 在游戏中按 **F11** 开启 DevMode
2. 在日志窗口中查找：
   ```
   [NarratorScreenButton] 全身立绘面板已打开
   ```
3. 如果看到这条日志，说明面板已成功创建

### 方法 2：视觉验证

**立绘模式开启后应该看到：**

| 区域 | 显示内容 | 尺寸 |
|------|---------|------|
| 画面左侧 | 全身立绘面板（**新增**） | 358×551 |
| 画面右上角 | AI按钮（显示头像） | 128×128 |

**如果看不到立绘面板：**
- ? 检查窗口大小（可能被裁剪掉了）
- ? 尝试全屏模式
- ? 尝试放大游戏窗口

---

## ?? 常见问题

### Q1: 勾选了"使用立绘模式"但没有看到立绘面板

**原因**：设置未生效

**解决方案**：
1. 确保点击了【应用】按钮
2. 尝试重启游戏（完全退出，不是回到主菜单）
3. 重新勾选设置

### Q2: AI按钮内的图像变成立绘了，但左侧没有独立面板

**原因**：代码逻辑错误（v1.6.24 设计为 AI按钮显示头像，立绘面板显示立绘）

**解决方案**：

当前架构：
- **AI按钮**：始终显示 512×512 头像
- **立绘面板**：显示 1024×1574 全身立绘

如果 AI按钮显示了立绘，说明 `UpdatePortrait()` 方法被错误调用了 `PortraitLoader`。

### Q3: 立绘面板显示了，但 AI按钮仍然是小图标

**原因**：AI按钮没有正确加载头像

**解决方案**：
1. 检查头像文件是否存在：
   ```
   Textures/UI/Narrators/Avatars/{人格名}/neutral.png
   ```
2. 开启 DevMode，查看日志是否有加载失败的提示

---

## ?? 配置文件位置

游戏内配置保存在：
```
C:\Users\[用户名]\AppData\LocalLow\Ludeon Studios\RimWorld by Ludeon Studios\Config\ModSettings.xml
```

**正确的配置内容**：
```xml
<ModSettings>
  <TheSecondSeatSettings>
    <usePortraitMode>True</usePortraitMode>
  </TheSecondSeatSettings>
</ModSettings>
```

---

## ?? 当前状态诊断

根据诊断脚本结果：

| 检查项 | 状态 | 说明 |
|--------|------|------|
| DLL 部署 | ? 成功 | 今天编译，包含立绘面板代码 |
| FullBodyPortraitPanel.cs | ? 存在 | 所有关键方法完整 |
| NarratorScreenButton.cs | ? 正确 | 包含面板管理代码 |
| ModSettings.cs | ? 正确 | usePortraitMode 设置存在 |
| 游戏内配置 | ? **未勾选** | 需要在游戏中勾选 |

**结论**：代码和部署都正确，只需要在游戏中勾选设置即可。

---

## ? 一键重新部署（如果需要）

如果你怀疑 DLL 有问题，可以执行以下命令重新编译并部署：

```powershell
cd "C:\Users\Administrator\Desktop\rim mod\The Second Seat"
dotnet build -c Release --nologo
Copy-Item "Source\TheSecondSeat\bin\Release\net472\TheSecondSeat.dll" "D:\steam\steamapps\common\RimWorld\Mods\TheSecondSeat\1.6\Assemblies\" -Force
Write-Host "? 重新部署完成，请重启游戏" -ForegroundColor Green
```

---

## ?? 游戏内操作截图位置参考

### 1. 打开 Mod 设置

```
[主菜单]
   ↓
按 ESC
   ↓
[选项]
   ↓
[Mod设置]
   ↓
[The Second Seat]
```

### 2. 勾选立绘模式

在 "The Second Seat" 设置页面，找到：
```
[ ] 使用立绘模式（1024x1572 全身立绘）
```

勾选后：
```
[?] 使用立绘模式（1024x1572 全身立绘）
    启用后，AI 按钮将显示完整立绘而非头像
    立绘尺寸：1024x1572（全身）
```

### 3. 点击应用按钮

在设置页面底部，找到并点击：
```
[应用]  [取消]  [查看示例]
```

---

## ?? 成功验证

勾选并应用设置后，返回游戏，你应该看到：

1. **画面左侧**：全身立绘面板（358×551 像素）
   - 显示完整的 1024×1574 立绘（缩放到35%）
   - 支持呼吸动画
   - 支持表情切换
   - 支持触摸互动

2. **画面右上角**：AI按钮（128×128 像素）
   - 显示 512×512 头像
   - 支持触摸互动
   - 好感度 +3

**如果仍然看不到立绘面板**：

请截图发送，并提供以下信息：
1. DevMode 日志（按 F11 开启）
2. 当前窗口尺寸（全屏/窗口模式）
3. 是否看到AI按钮（右上角）

---

**祝游戏愉快！** ?????
