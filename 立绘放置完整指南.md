# ?? 立绘放置完整指南

## ?? 立绘应该放在哪里？

### ?? 推荐方案：Mod 目录（开发者使用）

**路径**:
```
D:\steam\steamapps\common\RimWorld\Mods\TheSecondSeat\Textures\UI\Narrators\
```

**文件列表**:
```
Cassandra.png  ← Cassandra Classic
Phoebe.png     ← Phoebe Chillax
Randy.png      ← Randy Random
Igor.png       ← Igor Invader
Luna.png       ← Luna Protector
```

**操作步骤**:
```powershell
# 1. 进入 Mod 立绘目录
cd "D:\steam\steamapps\common\RimWorld\Mods\TheSecondSeat\Textures\UI\Narrators"

# 2. 查看当前文件
dir

# 3. 复制你的立绘文件（示例）
Copy-Item "C:\我的立绘\Cassandra.png" -Destination .
Copy-Item "C:\我的立绘\Phoebe.png" -Destination .
Copy-Item "C:\我的立绘\Randy.png" -Destination .
Copy-Item "C:\我的立绘\Igor.png" -Destination .
Copy-Item "C:\我的立绘\Luna.png" -Destination .

# 4. 验证文件
Get-ChildItem -Filter "*.png"
```

---

### ?? 备选方案：用户数据目录（玩家个性化）

**路径**:
```
C:\Users\Administrator\AppData\LocalLow\Ludeon Studios\RimWorld by Ludeon Studios\TheSecondSeat\Portraits\
```

**用途**:
- 玩家想用自己的立绘
- 不想修改 Mod 文件
- 需要在人格定义中启用 `useCustomPortrait`

**启用自定义立绘**:
```xml
<TheSecondSeat.PersonaGeneration.NarratorPersonaDef>
  <defName>Cassandra_Classic</defName>
  
  <!-- 启用自定义立绘 -->
  <useCustomPortrait>true</useCustomPortrait>
  <customPortraitPath>C:\Users\...\TheSecondSeat\Portraits\Cassandra.png</customPortraitPath>
  
  <!-- 或使用相对路径 -->
  <customPortraitPath>Portraits/Cassandra.png</customPortraitPath>
</TheSecondSeat.PersonaGeneration.NarratorPersonaDef>
```

---

## ?? 当前状态检查

### 检查 Mod 立绘目录

```powershell
# 查看 Mod 立绘目录内容
Get-ChildItem "D:\steam\steamapps\common\RimWorld\Mods\TheSecondSeat\Textures\UI\Narrators" `
    -Filter "*.png" | Select-Object Name, Length

# 预期输出（如果已放置）：
# Name          Length
# ----          ------
# Cassandra.png 150KB
# Phoebe.png    180KB
# Randy.png     165KB
# Igor.png      170KB
# Luna.png      155KB

# 实际输出（当前）：
# （空，只有 README.md）
```

### 检查用户数据目录

```powershell
# 查看用户立绘目录
Get-ChildItem "C:\Users\Administrator\AppData\LocalLow\Ludeon Studios\RimWorld by Ludeon Studios\TheSecondSeat\Portraits" `
    -ErrorAction SilentlyContinue | Select-Object Name, Length

# 如果目录不存在，会自动创建
```

---

## ?? 常见问题

### Q1: 为什么有两个立绘目录？

**A**: 
- **Mod 目录**：Mod 开发者提供的默认立绘（随 Mod 一起发布）
- **用户目录**：玩家自己放置的立绘（个性化，不会被 Mod 更新覆盖）

### Q2: 哪个优先级更高？

**A**: 用户目录 > Mod 目录 > 占位符

```
加载顺序：
1. 检查 customPortraitPath（用户目录）
2. 检查 portraitPath（Mod 目录）
3. 生成占位符
```

### Q3: 文件名必须一致吗？

**A**: 是的！必须与 `portraitPath` 最后一段匹配

```xml
<!-- 人格定义 -->
<portraitPath>UI/Narrators/Cassandra</portraitPath>

<!-- 对应文件路径 -->
Textures/UI/Narrators/Cassandra.png
                      ^^^^^^^^^ 必须一致
```

### Q4: 支持哪些图片格式？

**A**: 
- ? PNG（推荐，支持透明）
- ? JPG/JPEG（不支持透明）
- ? GIF（不支持动画）
- ? BMP（不推荐）

---

## ?? 立绘规格建议

| 属性 | 推荐值 | 说明 |
|------|-------|------|
| **尺寸** | 512x512 或 1024x1024 | 正方形，高分辨率 |
| **格式** | PNG（RGBA） | 支持透明背景 |
| **文件大小** | 50KB - 500KB | 平衡质量和加载速度 |
| **颜色模式** | RGBA32 | 支持 Alpha 通道 |
| **分辨率** | 72 DPI 或 150 DPI | 屏幕显示足够 |

---

## ?? 快速部署脚本

### 方法 1：手动复制

```powershell
# 设置源文件夹（你的立绘位置）
$sourceFolder = "C:\我的立绘文件夹"

# 设置目标文件夹（Mod 目录）
$targetFolder = "D:\steam\steamapps\common\RimWorld\Mods\TheSecondSeat\Textures\UI\Narrators"

# 复制所有立绘
Copy-Item "$sourceFolder\*.png" -Destination $targetFolder -Force

# 验证
Get-ChildItem $targetFolder -Filter "*.png"
```

### 方法 2：使用 Smart-Deploy.ps1

```powershell
# Smart-Deploy.ps1 已经会保护立绘，不会删除
# 直接将立绘复制到 Mod 目录即可

# 1. 复制立绘
Copy-Item "你的立绘\*.png" `
    -Destination "D:\steam\steamapps\common\RimWorld\Mods\TheSecondSeat\Textures\UI\Narrators\"

# 2. 运行部署脚本
.\Smart-Deploy.ps1

# Smart-Deploy 会跳过 Narrators 文件夹，保护你的立绘
```

---

## ? 验证清单

完成立绘放置后，检查：

- [ ] 文件已复制到正确目录
- [ ] 文件名与 `portraitPath` 匹配
- [ ] 文件大小 > 10KB（不是占位符）
- [ ] 文件格式为 PNG 或 JPG
- [ ] 图片可以正常打开（非损坏）
- [ ] 在游戏中切换人格，立绘确实不同

---

## ?? 推荐工作流

### 开发阶段（你现在）

1. **准备立绘文件**
   - 5个人格各准备一张立绘
   - 尺寸：512x512 或更大
   - 格式：PNG（支持透明）

2. **放置到 Mod 目录**
   ```powershell
   D:\steam\steamapps\common\RimWorld\Mods\TheSecondSeat\Textures\UI\Narrators\
   ```

3. **部署测试**
   ```powershell
   .\Smart-Deploy.ps1
   ```

4. **在游戏中验证**
   - 打开 AI 叙事者窗口
   - 点击"切换人格"
   - 确认每个人格的立绘都不同

### 发布阶段

1. **将立绘包含在 Mod 中**
   - 确保 Textures/UI/Narrators/ 中有所有立绘

2. **打包 Mod**
   - 包含 Textures 文件夹

3. **玩家安装后**
   - 立绘自动加载
   - 玩家可以自己替换（放到用户目录）

---

## ?? 故障排查

### 问题：立绘仍然是占位符

**检查**:
```powershell
# 1. 验证文件存在
Test-Path "D:\steam\steamapps\common\RimWorld\Mods\TheSecondSeat\Textures\UI\Narrators\Cassandra.png"

# 2. 检查文件大小
(Get-Item "D:\steam\steamapps\common\RimWorld\Mods\TheSecondSeat\Textures\UI\Narrators\Cassandra.png").Length

# 3. 查看游戏日志
# C:\Users\Administrator\AppData\LocalLow\Ludeon Studios\RimWorld by Ludeon Studios\Player.log
# 搜索 "[PortraitLoader]"
```

### 问题：文件名不匹配

**检查 portraitPath**:
```xml
<!-- 人格定义中 -->
<portraitPath>UI/Narrators/Cassandra</portraitPath>
               ^^^^^^^^^^^^^^^^^^^^^ 这部分必须对应

<!-- 实际文件路径 -->
Textures/UI/Narrators/Cassandra.png
         ^^^^^^^^^^^^^^^^^^^^^ 必须匹配
```

---

**总结**：
- ? **推荐**：立绘放在 `D:\steam\...\Mods\TheSecondSeat\Textures\UI\Narrators\`
- ? **可选**：用户自定义放在 `C:\Users\...\RimWorld\TheSecondSeat\Portraits\`
- ? **命名**：必须与 `portraitPath` 最后一段匹配
- ? **格式**：PNG（推荐）或 JPG
- ? **大小**：512x512 或更大

