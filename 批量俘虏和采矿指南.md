# 批量俘虏和批量采矿 - 使用指南

## ?? 新增命令概述

### 1. 批量俘虏 (BatchCapture)

**功能**：自动指定所有倒地的敌人进行俘虏，并分配看守执行任务。

**适用场景**：
- ? 战斗后快速俘虏大量敌人
- ? 补充劳动力或招募新殖民者
- ? 避免手动逐个点击

**执行条件**：
- 地图上有倒地的敌对人类
- 殖民地有至少一名启用"看守"工作的殖民者
- 倒地的敌人未死亡且可到达

---

### 2. 批量采矿 (BatchMine)

**功能**：批量指定地图上的矿物资源进行开采，支持多种目标过滤。

**适用场景**：
- ? 快速开采特定类型矿物（如金属、石料）
- ? 清理地图上所有矿脉
- ? 针对性采集稀有资源（组件、玉石等）

**支持的目标类型**：
- `all` - 所有可采矿资源
- `metal` - 金属矿（钢铁、金、银、铀、玉等）
- `stone` - 石料
- `component` / `components` - 组件矿脉
- 特定资源名称（如 `steel`, `gold`, `uranium`）

---

## ?? 使用方法

### 批量俘虏示例

#### 场景 1：战斗后俘虏所有敌人

```
玩家: "俘虏所有倒地的敌人"
```

**AI 执行**：
1. 扫描地图上所有倒地的敌对人类
2. 排除已死亡和已指定的敌人
3. 为每个敌人添加"俘虏"指定
4. 自动分配最近的看守执行

**结果反馈**：
```
? 已指定俘虏 5 名敌人
```

---

#### 场景 2：无可俘虏的敌人

```
玩家: "俘虏敌人"
```

**AI 执行**：
检查地图，发现没有倒地的敌人

**结果反馈**：
```
? 未找到可俘虏的倒地敌人
```

---

#### 场景 3：没有看守

```
玩家: "抓捕所有敌人"
```

**AI 执行**：
发现有倒地敌人，但没有殖民者启用"看守"工作

**结果反馈**：
```
? 无可用的看守执行俘虏任务
提示：请在工作优先级中为至少一名殖民者启用"看守"工作
```

---

### 批量采矿示例

#### 场景 1：采集所有矿物

```
玩家: "挖掉地图上所有矿"
或
玩家: "采集所有资源"
```

**AI 执行**：
```
target = "all"
扫描所有可采矿资源（钢铁、石料、金、银、玉等）
添加"采矿"指定
```

**结果反馈**：
```
? 已指定采矿 23 个资源点 (类型: all)
```

---

#### 场景 2：只采集金属矿

```
玩家: "只挖金属矿"
或
玩家: "采集钢铁和黄金"
```

**AI 执行**：
```
target = "metal"
过滤：钢铁、金、银、铀、玉、塑钢等
排除石料
```

**结果反馈**：
```
? 已指定采矿 8 个资源点 (类型: metal)
```

**包含的矿物**：
- Steel（钢铁）
- Gold（金）
- Silver（银）
- Uranium（铀）
- Plasteel（塑钢）
- Jade（玉）

---

#### 场景 3：只采集石料

```
玩家: "挖石头"
或
玩家: "开采石料"
```

**AI 执行**：
```
target = "stone"
过滤：所有石料（花岗岩、大理石、石灰岩等）
```

**结果反馈**：
```
? 已指定采矿 15 个资源点 (类型: stone)
```

---

#### 场景 4：采集组件

```
玩家: "挖组件矿"
或
玩家: "开采机械残骸"
```

**AI 执行**：
```
target = "component"
过滤：组件矿脉
```

**结果反馈**：
```
? 已指定采矿 2 个资源点 (类型: component)
```

---

#### 场景 5：采集特定资源（如黄金）

```
玩家: "只挖黄金"
或
玩家: "采集gold"
```

**AI 执行**：
```
target = "gold"
匹配：资源名称包含 "gold" 的矿脉
```

**结果反馈**：
```
? 已指定采矿 3 个资源点 (类型: gold)
```

---

#### 场景 6：无符合条件的资源

```
玩家: "挖钻石"
```

**AI 执行**：
扫描地图，未找到名称包含"钻石"的矿脉

**结果反馈**：
```
? 未找到符合条件的可采矿资源 (类型: 钻石)
```

---

## ?? 高级用法

### 组合命令

#### 示例 1：战斗后清理战场

```
玩家: "战斗结束了，帮我俘虏敌人并采集金属"
```

**AI 解析**：
1. BatchCapture（俘虏倒地敌人）
2. BatchMine(target: "metal")（采集金属矿）

**执行结果**：
```
? 已指定俘虏 3 名敌人
? 已指定采矿 5 个资源点 (类型: metal)
```

---

#### 示例 2：准备防御

```
玩家: "武装所有殖民者，然后挖掉附近的钢矿"
```

**AI 解析**：
1. BatchEquip(target: "Weapon")
2. BatchMine(target: "steel")

**执行结果**：
```
? 已命令 8 名殖民者装备
? 已指定采矿 4 个资源点 (类型: steel)
```

---

### 自然语言变体

#### 批量俘虏的多种表达

| 中文 | 英文 |
|-----|------|
| 俘虏所有敌人 | Capture all enemies |
| 抓捕倒地的人 | Arrest downed enemies |
| 把所有倒地的敌人抓起来 | Capture all downed hostiles |
| 俘虏战俘 | Imprison prisoners |

#### 批量采矿的多种表达

| 中文 | 英文 |
|-----|------|
| 挖矿 | Mine |
| 开采所有资源 | Excavate all resources |
| 采集金属 | Dig metal ore |
| 挖掉地图上的钢铁 | Mine all steel on the map |

---

## ?? 技术细节

### 批量俘虏逻辑

```
1. 查找所有倒地的敌对人类
   - Pawn.Downed == true
   - Pawn.HostileTo(Faction.OfPlayer) == true
   - Pawn.Dead == false
   - Pawn.RaceProps.Humanlike == true

2. 查找可用的看守
   - Colonist.Downed == false
   - Colonist.Dead == false
   - Colonist.workSettings.WorkIsActive(WorkTypeDefOf.Warden) == true

3. 为每个敌人分配最近的殖民者
   - 计算距离
   - 检查可到达性
   - 添加 DesignationDefOf.Capture

4. 返回成功数量
```

---

### 批量采矿过滤逻辑

```csharp
private static bool ShouldMine(Thing thing, string targetType)
{
    if (thing.def.building?.mineableThing == null)
        return false;

    var mineableItem = thing.def.building.mineableThing;

    return targetType switch
    {
        "all" => true,
        
        "metal" => 
            mineableItem.IsWithinCategory(ThingCategoryDefOf.ResourcesRaw) ||
            mineableItem.defName.Contains("Steel") ||
            mineableItem.defName.Contains("Gold") ||
            mineableItem.defName.Contains("Silver") ||
            mineableItem.defName.Contains("Uranium") ||
            mineableItem.defName.Contains("Plasteel") ||
            mineableItem.defName.Contains("Jade"),
        
        "stone" => 
            mineableItem.IsWithinCategory(ThingCategoryDefOf.StoneBlocks),
        
        "component" => 
            mineableItem.defName.Contains("Component"),
        
        _ => // 按名称匹配
            thing.def.defName.ToLower().Contains(targetType) ||
            mineableItem.defName.ToLower().Contains(targetType)
    };
}
```

---

## ?? 使用技巧

### 俘虏技巧

1. **提前准备牢房**
   - 确保有足够的监狱床位
   - 检查监狱门是否设置正确

2. **优先俘虏高技能敌人**
   - 手动检查敌人技能
   - 低技能的可以直接杀死

3. **控制俘虏数量**
   - 过多俘虏消耗大量食物
   - 需要足够的看守管理

---

### 采矿技巧

1. **优先采集稀有资源**
   ```
   玩家: "先挖金和铀"
   ```

2. **避免采集无用石料**
   ```
   玩家: "只挖金属，不要石头"
   ```

3. **战略性采矿**
   ```
   玩家: "清理基地周围的矿，留下外围的"
   ```

---

## ?? 常见问题

### Q1: 俘虏指令不生效？

**可能原因**：
1. 没有启用"看守"工作的殖民者
2. 所有殖民者都在忙碌
3. 监狱床位已满

**解决方法**：
```
1. 工作优先级 → 为殖民者启用"看守"
2. 暂停其他低优先级工作
3. 建造更多监狱床
```

---

### Q2: 采矿指令采集了不想要的矿物？

**解决方法**：
使用更精确的目标类型
```
玩家: "只挖钢铁和银" （而不是 "挖所有金属"）
```

---

### Q3: AI 不理解我的采矿指令？

**建议**：
使用更明确的关键词
```
? "挖金属矿"
? "采集钢铁"
? "那个亮亮的东西" （过于模糊）
```

---

## ?? 实战场景

### 场景 1：袭击后的清理

```
战斗结束
→ 玩家: "俘虏倒地的敌人，然后武装所有人"

AI 执行：
1. BatchCapture → 俘虏 4 名敌人
2. BatchEquip → 武装 8 名殖民者

结果：
- 获得 4 名潜在劳工/新成员
- 殖民者保持战备状态
```

---

### 场景 2：资源紧缺

```
钢铁不足
→ 玩家: "紧急开采所有钢矿"

AI 执行：
BatchMine(target: "steel")

结果：
- 指定 6 个钢矿开采
- 预计获得 ~300 钢铁
```

---

### 场景 3：快速扩张

```
玩家: "清理建造区域的所有矿，只留下金属"

AI 理解：
1. DesignatePlantCut（清理植物）
2. BatchMine(target: "stone")（清理石料）
3. 保留金属矿稍后采集

结果：
- 建造区域清空
- 金属资源保留供后续使用
```

---

## ?? 相关文档

- [功能总览.md](功能总览.md) - 所有命令列表
- [完整使用手册.md](完整使用手册.md) - 深度技术文档
- [快速入门.md](快速入门.md) - 新手指南

---

**版本**: 1.0.0  
**最后更新**: 2024  
**新增命令**: BatchCapture, BatchMine

?? **立即体验智能战场清理和资源管理！** ?
