# ?? 人格保存位置 - 快速参考

## ?? 两个保存位置

### 1?? 运行时（立即可用）

```
位置：内存（DefDatabase）
可用性：? 立即
持久性：? 游戏关闭后消失
```

### 2?? 文件系统（永久保存）

```
位置：Mod目录
可用性：下次启动
持久性：? 永久
```

---

## ?? 文件保存路径

### 立绘文件

```
D:\steam\steamapps\common\RimWorld\
└── Mods\TheSecondSeat\
    └── Textures\UI\Narrators\
        └── {人格名称}.png

例如：
- Dark_Dragon_Rider.png
- Mysterious_Mage.png
```

### XML定义文件

```
D:\steam\steamapps\common\RimWorld\
└── Mods\TheSecondSeat\
    └── Defs\NarratorPersonaDefs\
        └── {defName}.xml

例如：
- CustomPersona_abc12345.xml
- DarkDragonRider.xml
```

---

## ?? 完整保存流程

```
1. 用户选择立绘
   ↓
2. Vision API分析
   ↓
3. 创建人格对象
   ↓
4. ? DefDatabase.Add()        ← 立即可用
   ↓
5. 复制立绘到Mod目录          ← 永久保存
   ↓
6. 生成并保存XML文件          ← 永久保存
   ↓
7. 完成！
```

---

## ?? 查看已保存的人格

### 游戏内

```
人格选择窗口 → 查看人格列表
```

### 文件管理器

```
1. 打开：Textures\UI\Narrators\
2. 查看：所有.png立绘文件

3. 打开：Defs\NarratorPersonaDefs\
4. 查看：所有.xml定义文件
```

### 开发者控制台

```csharp
var personas = DefDatabase<NarratorPersonaDef>.AllDefsListForReading;
Log.Message($"人格数量: {personas.Count}");
```

---

## ??? 常见操作

### 编辑人格

```
1. 打开XML文件
2. 修改参数
3. 保存文件
4. 重启游戏
```

### 删除人格

```
删除两个文件：
- Textures\UI\Narrators\{人格名称}.png
- Defs\NarratorPersonaDefs\{defName}.xml

然后重启游戏
```

### 备份人格

```
复制两个目录：
- Textures\UI\Narrators\
- Defs\NarratorPersonaDefs\

粘贴到安全位置
```

### 分享人格

```
打包两个文件：
- {人格名称}.png
- {defName}.xml

发送给其他玩家
```

---

## ?? 重要提示

### 文件命名规则

```
立绘：{人格名称}.png
XML：{defName}.xml

defName规则：
- 自动生成：CustomPersona_{随机8位}
- 手动设置：任意合法文件名
```

### 立即可用 vs 永久保存

| 特性 | DefDatabase | 文件保存 |
|-----|-------------|---------|
| **何时可用** | 立即 | 下次启动 |
| **是否永久** | ? | ? |
| **能否分享** | ? | ? |
| **能否编辑** | ? | ? |

### 双重保存的好处

```
? 生成后立即可用（不用重启）
? 重启后仍然保留（不会丢失）
? 可以手动调整（编辑XML）
? 可以分享给他人（复制文件）
```

---

## ?? 文件关联示例

### 示例1：黑暗龙骑士

```
立绘文件：
Textures/UI/Narrators/Dark_Dragon_Rider.png

XML文件：
Defs/NarratorPersonaDefs/CustomPersona_abc12345.xml

内容：
<portraitPath>UI/Narrators/Dark_Dragon_Rider</portraitPath>
                              ↑ 不含扩展名
```

### 示例2：神秘法师

```
立绘文件：
Textures/UI/Narrators/Mysterious_Mage.png

XML文件：
Defs/NarratorPersonaDefs/MysteriousMage.xml

内容：
<portraitPath>UI/Narrators/Mysterious_Mage</portraitPath>
```

---

## ?? 故障排除

### 问题：重启后人格消失

**检查**：
```
1. 查看日志：开发者模式 → 日志窗口
2. 检查文件：是否存在PNG和XML
3. 验证路径：portraitPath是否正确
```

### 问题：立绘不显示

**检查**：
```
1. 文件格式：必须是PNG
2. 文件位置：必须在Narrators目录
3. 路径配置：XML中的portraitPath
```

### 问题：无法生成人格

**检查**：
```
1. API配置：是否正确设置
2. API余额：是否有足够额度
3. 磁盘空间：是否有足够空间
4. 权限问题：是否有写入权限
```

---

## ?? 相关文档

- [多模态分析生成的人格保存位置.md](多模态分析生成的人格保存位置.md) - 详细说明
- [多模态AI分析完整指南.md](多模态AI分析完整指南.md) - API配置
- [人格生成系统指南.md](人格生成系统指南.md) - 手动创建

---

**快速访问**：
- 立绘目录：`{Mod根目录}\Textures\UI\Narrators\`
- 定义目录：`{Mod根目录}\Defs\NarratorPersonaDefs\`

**立即可用 + 永久保存 = 最佳体验！** ?
