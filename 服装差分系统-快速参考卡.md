# 服装差分系统 - 快速参考卡

## ?? 核心功能

**服装随好感度和时间动态变化**
- ? 每 12 小时自动更换服装
- ?? 好感度变化时立即更换等级
- ?? 每个等级支持多个变体

---

## ?? 服装等级速查表

| 好感度 | 服装等级 | 文件前缀 | 风格描述 | 示例 |
|-------|---------|---------|---------|------|
| **85-100** | Devoted | `devoted_` | 极度亲密 | 情侣装、私密服装 |
| **60-85** | Intimate | `intimate_` | 放松私密 | 睡衣、便装 |
| **30-60** | Warm | `warm_` | 亲切舒适 | 毛衣、家居服 |
| **-10-30** | Neutral | `neutral_` | 日常专业 | 休闲装、工作服 |
| **-50--10** | Cold | `cold_` | 正式距离 | 正装、制服 |
| **-100--50** | Hostile | `hostile_` | 冷峻疏离 | 军装、战斗服 |

---

## ?? 文件结构

### 标准结构
```
Textures/UI/Narrators/9x16/
└─ Cassandra/
   ├─ base.png                ← 基础立绘
   └─ Outfits/                ← 服装文件夹 ?
      ├─ hostile_1.png        ← 敌意服装变体1
      ├─ hostile_2.png        ← 敌意服装变体2
      ├─ cold_1.png
      ├─ neutral_1.png
      ├─ neutral_2.png
      ├─ warm_1.png
      ├─ warm_2.png
      ├─ intimate_1.png
      ├─ intimate_2.png
      └─ devoted_1.png
```

### 命名规范
```
格式: {等级}_{变体序号}.png

hostile_1.png     ? 正确
Hostile_1.png     ? 错误（大写）
hostile1.png      ? 错误（缺少下划线）
```

---

## ?? 更换逻辑

### 触发条件

#### 1. 时间触发
```
每 12 游戏小时（30,000 ticks）自动更换
```

#### 2. 好感度变化
```
从 Neutral (25) → Warm (35)
立即更换服装等级
```

### 更换流程
```
1. 检查触发条件
   └─ 时间到了？好感度变化？

2. 确定服装等级
   └─ GetOutfitTierByAffinity(affinity)

3. 随机选择变体
   └─ warm_1, warm_2, warm_3 中随机

4. 加载和叠加
   └─ base.png + warm_2.png + 表情

5. 更新缓存
   └─ 清空旧缓存，显示新立绘
```

---

## ?? 服装制作指南

### 文件规格
- **尺寸**: 1080x1920 (与基础立绘相同)
- **格式**: PNG (支持透明)
- **透明**: 保持人物轮廓，只修改服装

### 设计要点

#### Devoted（献身）- 85-100
```
风格: 极度亲密、性感
颜色: 红、黑、粉
细节: 丝质睡衣、情趣服装
```

#### Intimate（亲密）- 60-85
```
风格: 放松、私密
颜色: 柔和色（粉、白）
细节: 睡衣、浴袍、吊带
```

#### Warm（温暖）- 30-60
```
风格: 亲切、舒适
颜色: 暖色调（粉、黄）
细节: 针织衫、休闲装
```

#### Neutral（中性）- -10-30
```
风格: 日常、专业
颜色: 暖色、中性色
细节: 衬衫+裤子、便装
```

#### Cold（冷漠）- -50--10
```
风格: 正式、保守
颜色: 中性色（灰、深蓝）
细节: 正装、西装、制服
```

#### Hostile（敌意）- -100--50
```
风格: 冷峻、疏离
颜色: 深色、冷色调
细节: 军装、盔甲、高领
```

---

## ?? 代码示例

### 检查服装状态
```csharp
var state = OutfitSystem.GetOutfitState("Cassandra_Classic");
Log.Message($"当前服装等级: {state.currentTier}");
Log.Message($"当前服装: {state.currentOutfitPath}");
```

### 手动更换服装
```csharp
OutfitSystem.ChangeOutfit("Cassandra_Classic", currentAffinity);
PortraitLoader.ClearCache(); // 刷新显示
```

### 获取下次更换时间
```csharp
float hours = OutfitSystem.GetTimeUntilNextChange("Cassandra_Classic");
Log.Message($"下次更换: {hours:F1} 小时后");
```

---

## ?? 测试清单

### 基础测试
- [ ] 服装文件正确命名和放置
- [ ] 基础立绘正常显示
- [ ] 服装差分正确叠加

### 功能测试
- [ ] 12小时自动更换
- [ ] 好感度变化立即更换
- [ ] 随机选择变体（不重复）

### 集成测试
- [ ] 服装 + 表情正确叠加
- [ ] 缓存正确更新
- [ ] 存档保存/加载

---

## ?? 示例场景

### 场景 1: 从中性到温暖
```
初始:
- 好感度: 0
- 服装: neutral_1.png

12小时后:
- 服装: neutral_2.png (自动切换)

好感度提升到 40:
- 服装等级: Warm (立即切换)
- 新服装: warm_1.png
```

### 场景 2: 高好感度变化
```
好感度 70:
- 服装等级: Intimate
- 当前: intimate_1.png

12小时后:
- 自动切换: intimate_2.png

好感度提升到 90:
- 服装等级: Devoted (立即切换)
- 新服装: devoted_1.png
```

---

## ??? 调试命令

### 在 DebugWindows.cs 中添加
```csharp
// 显示服装信息
var outfitState = OutfitSystem.GetOutfitState(persona.defName);
Widgets.Label(rect, $"服装等级: {outfitState.currentTier}");
Widgets.Label(rect, $"当前服装: {Path.GetFileNameWithoutExtension(outfitState.currentOutfitPath)}");
Widgets.Label(rect, $"下次更换: {OutfitSystem.GetTimeUntilNextChange(persona.defName):F1} 小时");

// 手动更换按钮
if (Widgets.ButtonText(rect, "更换服装"))
{
    OutfitSystem.ChangeOutfit(persona.defName, agent.affinity);
    PortraitLoader.ClearCache();
}
```

---

## ?? 常见问题

### Q: 服装不显示？
```
1. 检查文件名是否全小写
2. 检查文件路径是否正确
3. 查看日志确认加载状态
```

### Q: 服装叠加不正确？
```
1. 确保尺寸一致（1080x1920）
2. 检查透明通道
3. 验证 Alpha 混合
```

### Q: 12小时不更换？
```
1. 检查游戏时间是否真的过了12小时
2. 查看 lastChangeTimestamp
3. 确认没有服装等级变化（会重置计时）
```

---

## ?? 快速实施

### Step 1: 创建文件夹
```
Textures/UI/Narrators/9x16/Cassandra/Outfits/
```

### Step 2: 准备服装文件
```
至少准备 1-2 个服装差分：
- neutral_1.png
- warm_1.png
```

### Step 3: 测试
```
1. 启动游戏
2. 调整好感度
3. 查看服装变化
4. 等待12小时测试
```

---

## ?? 制作建议

### 优先级
```
1?? Neutral (最常见，优先制作 2-3 个)
2?? Warm (常见，制作 2 个)
3?? Intimate (重要，制作 1-2 个)
4?? Cold, Hostile, Devoted (根据需求)
```

### 工作量估算
```
单个角色完整服装：
- 6 个等级 × 2 个变体 = 12 个服装
- 预计时间: 12-20 小时
```

---

**版本**: v1.0  
**状态**: ? 代码已实现，待制作美术资源  
**创建时间**: 2025-01-XX
