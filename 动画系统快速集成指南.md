# 动画系统快速集成指南

## ?? 核心集成步骤

### 1?? 在 NarratorScreenButton 中集成

**只需修改一行代码！**

```csharp
public override void DoWindowContents(Rect inRect)
{
    // ? 旧代码（删除）
    // Texture2D texture = currentPortrait ?? GenerateFallbackTexture();
    
    // ? 新代码（替换为这一行）
    Texture2D texture = PortraitController.Instance.GetCurrentPortrait(currentPersona);
    
    // 绘制按钮
    if (Widgets.ButtonImage(inRect, texture))
    {
        ToggleNarratorWindow();
    }
}
```

---

### 2?? 在 NarratorWindow 中集成

**同样只需修改一行代码！**

```csharp
private void DrawPortrait(Rect rect)
{
    var persona = GetCurrentPersona();
    
    if (persona != null)
    {
        // ? 旧代码（删除）
        // Texture2D texture = PortraitLoader.LoadPortrait(persona);
        
        // ? 新代码（替换为这一行）
        Texture2D texture = PortraitController.Instance.GetCurrentPortrait(persona);
        
        GUI.DrawTexture(rect, texture, ScaleMode.ScaleToFit);
    }
}
```

---

## ?? XML 配置（已完成）

**文件：** `Defs/NarratorPersonaDefs.xml`

```xml
<TheSecondSeat.PersonaGeneration.NarratorPersonaDef>
    <defName>Sideria_Default</defName>
    
    <!-- ? 已配置 -->
    <portraitPath>UI/Narrators/9x16/Sideria/base</portraitPath>
    <portraitPathBlink>UI/Narrators/9x16/Sideria/blink</portraitPathBlink>
    <portraitPathSpeaking>UI/Narrators/9x16/Sideria/speaking</portraitPathSpeaking>
</TheSecondSeat.PersonaGeneration.NarratorPersonaDef>
```

---

## ?? 纹理文件准备

### 放置位置

```
Textures/UI/Narrators/9x16/Sideria/
├── base.png      (必需)
├── blink.png     (可选)
└── speaking.png  (可选)
```

### 纹理规格

- **尺寸：** 512x512 或 1024x1024
- **格式：** PNG（支持透明）
- **大小：** < 2 MB/张

---

## ? 就这么简单！

### 集成完成后的效果

1. **自动眨眼** - 每 3-6 秒眨眼 0.15 秒
2. **语音同步** - TTS 播放时显示张嘴纹理
3. **优先级** - 眨眼 > 说话 > 默认
4. **回退机制** - 纹理缺失时自动使用 base

---

## ?? 测试步骤

1. 编译项目
2. 启动游戏
3. 观察 AI 按钮（3-6 秒会眨眼）
4. 发送消息并播放 TTS（会显示说话动画）

---

**集成指南完成！** ?

_The Second Seat Mod Team_
