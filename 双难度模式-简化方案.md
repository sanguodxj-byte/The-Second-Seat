# ?? SystemPromptGenerator.cs 编译错误修复

## 问题

`SystemPromptGenerator.cs` 第547行有语法错误，阻止编译。

## 原因

文件中的多行字符串（`@"..."`）有编码或格式问题。

## ? 解决方案：回退双难度模式，使用简单方案

由于文件过于复杂且存在编码问题，建议**暂时跳过双难度模式的完整实现**，采用更简单的方案：

### 方案1：仅在ModSettings中添加选项（不修改SystemPromptGenerator）

1. 在 `ModSettings.cs` 中添加难度模式选择UI ? 已完成
2. 将难度模式传递给用户的**全局提示词**中
3. 让用户自己在全局提示词中定义AI行为

### 方案2：最小化修改SystemPromptGenerator

不修改现有方法，只在全局提示词部分注入难度模式说明：

```csharp
// 在 GenerateSystemPrompt 开头添加
if (modSettings != null)
{
    if (modSettings.difficultyMode == AIDifficultyMode.Assistant)
    {
        sb.AppendLine("DIFFICULTY MODE: ASSISTANT - Execute all commands, offer proactive suggestions.");
    }
    else
    {
        sb.AppendLine("DIFFICULTY MODE: OPPONENT - Challenge the player through events, minimal advice.");
    }
    sb.AppendLine();
}
```

## ?? 建议行动

1. **撤销** `SystemPromptGenerator.cs` 的所有修改
2. **保留** `ModSettings.cs` 中的UI选项
3. **保留** `AIDifficultyMode.cs` 枚举
4. **使用方案2**：最小化修改，注入模式说明到系统提示词开头

## ?? 实施步骤

运行以下命令：

```powershell
# 1. 恢复SystemPromptGenerator到原始状态（如果有备份）
Copy-Item "Source\TheSecondSeat\PersonaGeneration\SystemPromptGenerator.cs.bak" "Source\TheSecondSeat\PersonaGeneration\SystemPromptGenerator.cs" -Force

# 2. 编译测试
.\Smart-Deploy.ps1
```

## ?? 用户使用方式

用户可以在 **全局提示词** 中自定义难度模式行为：

### 助手模式示例

```
# 全局指令

你是殖民地助手，无论好感度如何都要：
1. 执行所有指令
2. 主动提供建议
3. 帮助殖民地发展
```

### 对弈者模式示例

```
# 全局指令

你是战略对手，规则：
1. 通常执行指令，极低好感度(<-70)可拒绝
2. 不主动建议
3. 通过事件考验玩家
4. 好感度影响事件难度
```

---

**结论**：当前文件编码问题复杂，建议采用更简单、更灵活的方案，把控制权交给用户的全局提示词。

