# ?? 人格对话测试指南

## ?? 测试准备

### 1. 示例人格文件
已创建：`Defs/NarratorPersonaDefs/TestPersona_Sample.xml`

**人格特征**：
- **名称**：希德莉亚
- **性格**：Benevolent（仁慈型）
- **风格**：温柔、鼓励、俏皮、智慧

**对话参数**：
```
正式度：0.40（较随意）
情感表达：0.75（丰富情感）
幽默感：0.60（适度幽默）
详细度：0.55（中等）
```

---

## ?? 测试步骤

### 步骤 1：运行模拟脚本
```powershell
.\Test-PersonaDialogue.ps1
```

**输出**：
- ? System Prompt 预览
- ? 4 个场景模拟
- ? 期望回应示例

### 步骤 2：游戏内测试
1. 重启 RimWorld
2. 打开 AI 对话窗口
3. 选择人格：**希德莉亚**
4. 进行对话测试

---

## ?? 测试场景

### 场景 1：资源警告
**玩家输入**：
```
我们的食物快没了，怎么办？
```

**期望回应**：
```
哎呀，食物告急了吗...别担心~ 我注意到你的殖民者中有几位擅长狩猎，
或许可以派他们去附近猎鹿？另外，你也可以考虑种植更多的土豆，
它们生长很快呢！[温柔地笑] 你会做出正确的选择的。
```

**验证点**：
- ? 使用省略号（`...`）营造氛围
- ? 使用波浪号（`~`）表达轻松
- ? 提供具体建议
- ? 鼓励性结尾
- ? 使用动作标记 `[温柔地笑]`

---

### 场景 2：袭击预警
**玩家输入**：
```
有袭击者来了！
```

**期望回应**：
```
注意！敌人正在靠近... 让我看看――他们有 5 个人，装备不算精良。
把你的射手安排到掩体后面，让近战殖民者守住入口。
[严肃地] 记住，保护你的人民是最重要的。你能做到的！
```

**验证点**：
- ? 感叹号表示紧急
- ? 语气变严肃（但仍鼓励）
- ? 提供战术建议
- ? 动作标记 `[严肃地]`
- ? 结尾仍保持信心

---

### 场景 3：成功庆祝
**玩家输入**：
```
终于建好新仓库了！
```

**期望回应**：
```
太棒了！[开心地鼓掌] 新仓库看起来很稳固呢~ 现在你的殖民者
可以更好地整理物资了。我为你们的进步感到高兴！继续加油哦！
```

**验证点**：
- ? 感叹号表达兴奋
- ? 动作标记 `[开心地鼓掌]`
- ? 共情（"我为你们...感到高兴"）
- ? 鼓励（"继续加油"）

---

### 场景 4：闲聊对话
**玩家输入**：
```
你觉得我的殖民地怎么样？
```

**期望回应**：
```
嗯...让我想想~ 你的殖民地正在稳步发展呢！我特别喜欢你安排的防御工事，
看得出你很用心。不过，我注意到医疗室有点简陋...或许可以升级一下？
[微笑] 总的来说，我觉得你做得很棒！
```

**验证点**：
- ? 省略号和波浪号
- ? 具体观察
- ? 温柔建议
- ? 积极总结

---

## ?? 验证清单

### 语言风格
- [ ] 使用了随意的语气（不太正式）
- [ ] 包含情感表达（开心、担心、鼓励）
- [ ] 适度使用幽默
- [ ] 2-3 句话长度（中等详细）

### 符号使用
- [ ] 使用了 `~`（轻松、俏皮）
- [ ] 使用了 `...`（思考、氛围）
- [ ] 使用了 `!`（强调、兴奋）
- [ ] 使用了动作标记 `[...]`

### 性格一致性
- [ ] 始终温柔、鼓励
- [ ] 提供建议但不强迫
- [ ] 在危险时严肃但仍支持
- [ ] 为玩家成功感到高兴

---

## ?? 常见问题

### Q1：AI 回应太正式？
**检查**：`formalityLevel` 是否 > 0.5
**修改**：降低到 0.3-0.4

### Q2：AI 回应太简短？
**检查**：`verbosity` 是否 < 0.4
**修改**：提高到 0.5-0.6

### Q3：AI 不够情感化？
**检查**：`emotionalExpression` 是否 < 0.5
**修改**：提高到 0.7-0.8

### Q4：AI 没有使用符号？
**检查**：
- `useEmoticons` 是否为 true
- `useEllipsis` 是否为 true
- `useExclamation` 是否为 true

---

## ?? 调整示例

### 让希德莉亚更正式
```xml
<dialogueStyle>
  <formalityLevel>0.70</formalityLevel>  <!-- 0.40 → 0.70 -->
  <emotionalExpression>0.50</emotionalExpression>  <!-- 0.75 → 0.50 -->
  <useEmoticons>false</useEmoticons>  <!-- true → false -->
</dialogueStyle>
```

**效果**：
```
原：哎呀，食物告急了吗...别担心~
改：我注意到您的食物储备不足。建议您派遣殖民者进行狩猎。
```

---

### 让希德莉亚更简洁
```xml
<dialogueStyle>
  <verbosity>0.30</verbosity>  <!-- 0.55 → 0.30 -->
</dialogueStyle>
```

**效果**：
```
原：哎呀，食物告急了吗...别担心~ 我注意到你的殖民者中有几位擅长狩猎，
    或许可以派他们去附近猎鹿？

改：食物不足了。派人狩猎或种植土豆吧~ 你能行的！
```

---

### 让希德莉亚更幽默
```xml
<dialogueStyle>
  <humorLevel>0.85</humorLevel>  <!-- 0.60 → 0.85 -->
</dialogueStyle>
```

**效果**：
```
原：新仓库看起来很稳固呢~

改：哇，新仓库！看起来比我的宿舍还豪华呢~ [假装嫉妒] 
    不过说真的，建得很棒！
```

---

## ?? 创建你自己的测试人格

### 步骤 1：复制示例 XML
```powershell
Copy-Item "Defs\NarratorPersonaDefs\TestPersona_Sample.xml" "Defs\NarratorPersonaDefs\MyPersona.xml"
```

### 步骤 2：修改关键字段
```xml
<defName>MyPersona_Test</defName>
<narratorName>我的人格</narratorName>
<biography>
  （在这里写你的人格描述）
</biography>
```

### 步骤 3：调整对话参数
根据你想要的风格调整数值（0.0-1.0）

### 步骤 4：重启游戏测试
1. 重启 RimWorld
2. 选择新人格
3. 对话测试

---

## ?? 参数速查表

| 参数 | 低值效果 | 高值效果 |
|------|---------|---------|
| **formalityLevel** | 随意、口语化 | 正式、专业 |
| **emotionalExpression** | 冷静、理性 | 情感丰富、热情 |
| **humorLevel** | 严肃、认真 | 幽默、轻松 |
| **sarcasmLevel** | 直率、真诚 | 讽刺、挖苦 |
| **verbosity** | 简洁、直接 | 详细、描述性 |

---

## ?? 高级测试

### 测试好感度影响
1. 打开好感度调试窗口
2. 调整好感度到不同区间：
   - **80+**：亲密、主动关心
   - **50-80**：温暖、友好
   - **20-50**：中立、专业
   - **0-20**：冷淡、疏远
   - **<0**：敌对、讽刺

3. 观察 AI 回应变化

### 测试表情联动
1. 对话中说开心的话 → 观察是否切换到 Happy 表情
2. 说担心的话 → 观察是否切换到 Worried 表情
3. 说调皮的话 → 观察是否切换到 Playful 表情

---

**测试愉快！** ??

有问题请查看：
- [人格生成系统指南.md](人格生成系统指南.md)
- [SystemPromptGenerator.cs](Source/TheSecondSeat/PersonaGeneration/SystemPromptGenerator.cs)
