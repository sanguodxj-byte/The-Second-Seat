# 半透明透明度快速修复 - v1.6.50

## ?? 问题
半透明模式下，面部部件叠加后出现"双重透明"效果

## ? 解决方案（简单版）

### 修改文件
`Source\TheSecondSeat\UI\FullBodyPortraitPanel.cs`

### 找到这段代码（约第130-150行）

```csharp
// ? 关键修复：半透明模式下使用预合成纹理
if (alpha < 1.0f)
{
    // 半透明模式：绘制预合成的完整纹理
    DrawCompositePortrait(animatedRect, currentPersona, alpha);
}
else
{
    // 完全不透明模式：直接分层绘制（性能更好）
    GUI.color = Color.white;
    DrawLayeredPortraitRuntime(animatedRect, currentPersona);
    GUI.color = Color.white;
}
```

### 替换为

```csharp
// ? 关键修复：统一使用 GUI.color 控制透明度
GUI.color = new Color(1f, 1f, 1f, alpha);
DrawLayeredPortraitRuntime(animatedRect, currentPersona);
GUI.color = Color.white;
```

---

## ?? 一键修复命令

```powershell
# 备份原文件
Copy-Item "Source\TheSecondSeat\UI\FullBodyPortraitPanel.cs" "Source\TheSecondSeat\UI\FullBodyPortraitPanel.cs.bak"

# 应用修复（手动修改，或使用 Git 恢复后重新编辑）
# 找到包含 "if (alpha < 1.0f)" 的代码块
# 删除整个 if-else 块
# 替换为上面的3行代码
```

---

## ?? 完整修改示例

**修改前（约第130-150行）：**
```csharp
// 应用呼吸动画偏移
float breathingOffset = ExpressionSystem.GetBreathingOffset(currentPersona.defName);
Rect animatedRect = new Rect(drawRect.x, drawRect.y + breathingOffset, drawRect.width, drawRect.height);

// ? 关键修复：半透明模式下使用预合成纹理
if (alpha < 1.0f)
{
    // 半透明模式：绘制预合成的完整纹理
    DrawCompositePortrait(animatedRect, currentPersona, alpha);
}
else
{
    // 完全不透明模式：直接分层绘制（性能更好）
    GUI.color = Color.white;
    DrawLayeredPortraitRuntime(animatedRect, currentPersona);
    GUI.color = Color.white;
}
```

**修改后：**
```csharp
// 应用呼吸动画偏移
float breathingOffset = ExpressionSystem.GetBreathingOffset(currentPersona.defName);
Rect animatedRect = new Rect(drawRect.x, drawRect.y + breathingOffset, drawRect.width, drawRect.height);

// ? 关键修复：统一使用 GUI.color 控制透明度（避免双重透明）
GUI.color = new Color(1f, 1f, 1f, alpha);
DrawLayeredPortraitRuntime(animatedRect, currentPersona);
GUI.color = Color.white;
```

---

## ? 优点

1. **代码简单**：3行代码替换整个 if-else 块
2. **性能优秀**：无需 RenderTexture 预合成
3. **效果自然**：Unity 内置混合模式处理透明度
4. **易于维护**：逻辑清晰，无额外复杂性

---

## ?? 测试

1. 编译并部署
2. 游戏中鼠标移到立绘上（不按 Shift）
3. 观察半透明效果是否自然
4. 检查嘴部和眼睛区域透明度是否一致

---

**简单3行代码，完美解决问题！**
