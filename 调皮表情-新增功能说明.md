# ? 调皮表情 (Playful) - 新增功能说明

## ?? **版本信息**

- **添加时间**: 2025-12-03
- **表情总数**: 11 个（新增调皮表情）
- **文件名**: `playful.png` 或 `playful.jpg`

---

## ?? **表情定义**

### **ExpressionType.Playful**

```csharp
public enum ExpressionType
{
    // ...
    Playful       // 调皮 ? 新增
}
```

**特点**：
- 俏皮、顽皮、带点捉弄意味
- 适合轻松愉快的对话场景
- 比 Happy（开心）更活泼，比 Smug（得意）更可爱

---

## ?? **文件放置位置**

### **Sideria 示例**

```
Textures/UI/Narrators/9x16/Expressions/Sideria/
├─ happy.png
├─ sad.png
├─ angry.png
├─ surprised.png
├─ thoughtful.png
├─ annoyed.png
├─ smug.png
├─ worried.png
├─ disappointed.png
└─ playful.png  ? 新增
```

### **其他人格**

```
Textures/UI/Narrators/9x16/Expressions/{人格名}/
└─ playful.png
```

---

## ?? **触发条件**

### **1. 手动触发**

```csharp
ExpressionSystem.SetExpression("Sideria_Default", ExpressionType.Playful);
```

### **2. 对话关键词自动触发**

| 语言 | 关键词 |
|------|--------|
| **中文** | 嘿嘿、嘻嘻、逗你、开玩笑、捉弄、调皮 |
| **英文** | playful, teasing, mischievous, hehe, hihi |

**示例对话**：

```
AI: "嘿嘿，我就知道你会这么说~ ??"
→ 自动切换到 Playful 表情

AI: "I'm just teasing you!"
→ 自动切换到 Playful 表情
```

### **3. 好感度触发**（可扩展）

目前未配置，可以在高好感度时随机触发：

```csharp
if (affinity >= 700f && Random.value < 0.1f)
{
    ExpressionSystem.SetExpression(personaDefName, ExpressionType.Playful);
}
```

---

## ??? **立绘制作建议**

### **表情特征**

| 部位 | 建议 |
|------|------|
| **眼睛** | 微眯、带笑意、可以眨一只眼 |
| **嘴巴** | 微笑、嘴角上扬、可以吐舌头 |
| **眉毛** | 略微上扬、俏皮 |
| **整体** | 轻松活泼、带点恶作剧感 |

### **参考表情**

- ?? (俏皮微笑)
- ?? (吐舌头)
- ?? (开心微笑)
- ?? (调皮)

### **与其他表情的区别**

| 表情 | 区别 |
|------|------|
| **Happy (开心)** | 纯粹的快乐，没有捉弄意味 |
| **Smug (得意)** | 自信、略带优越感 |
| **Playful (调皮)** | 俏皮、活泼、带点恶作剧 ? |

---

## ??? **技术实现**

### **1. 文件名后缀映射**

```csharp
public static string GetExpressionSuffix(ExpressionType expression)
{
    return expression switch
    {
        // ...
        ExpressionType.Playful => "_playful",  // ?
        _ => ""
    };
}
```

### **2. 关键词检测**

```csharp
else if (ContainsKeywords(dialogueText, new[] { 
    "嘿嘿", "嘻嘻", "逗你", "开玩笑", "捉弄", "调皮", 
    "playful", "teasing", "mischievous", "hehe", "hihi" 
}))
{
    expression = ExpressionType.Playful;
}
```

### **3. 文件加载路径**

```
UI/Narrators/9x16/Expressions/{PersonaName}/playful
```

---

## ?? **当前表情系统完整列表**

| # | 表情名 | 文件名 | 触发关键词 |
|---|--------|--------|-----------|
| 1 | Neutral | `base.png` | 默认 |
| 2 | Happy | `happy.png` | 哈哈、真好、太棒、开心 |
| 3 | Sad | `sad.png` | 悲伤、难过、可怜 |
| 4 | Angry | `angry.png` | 可恶、该死、愤怒 |
| 5 | Surprised | `surprised.png` | 什么、不会吧、哇 |
| 6 | Worried | `worried.png` | 担心、忧虑、危险 |
| 7 | Smug | `smug.png` | 看吧、我说、果然 |
| 8 | Disappointed | `disappointed.png` | 失望、算了、唉 |
| 9 | Thoughtful | `thoughtful.png` | 嗯、让我想想、或许 |
| 10 | Annoyed | `annoyed.png` | 烦、真是的、算了 |
| 11 | **Playful** ? | **`playful.png`** | **嘿嘿、嘻嘻、逗你** |

---

## ?? **测试方法**

### **1. 手动测试**

```
1. 重启 RimWorld
2. 开启调试模式
3. 打开人格选择窗口
4. 右键人格 → [调试] 表情
5. 选择 "Playful (调皮)"
6. 观察立绘是否切换
```

### **2. 对话测试**

```
1. 打开 AI 对话窗口
2. 输入：你好呀~ 嘿嘿
3. 观察人格是否自动切换到调皮表情
```

### **3. 日志验证**

开启调试模式后，查找以下日志：

```
[ExpressionSystem] Sideria_Default 表情切换: Neutral → Playful (触发: DialogueTone)
[PortraitLoader] ? 从 Expressions 加载整图表情: UI/Narrators/9x16/Expressions/Sideria/playful
```

---

## ?? **后续扩展建议**

### **1. 添加更多调皮触发场景**

```csharp
// 示例：高好感度随机触发
if (affinity >= 700f && eventType == "player_praised")
{
    if (Random.value < 0.2f)  // 20% 概率
    {
        ExpressionSystem.SetExpression(personaDefName, ExpressionType.Playful);
    }
}
```

### **2. 表情组合动画**

```csharp
// 示例：开心 → 调皮 → 开心 的组合
ExpressionSystem.SetExpression(personaDefName, ExpressionType.Happy);
await Task.Delay(2000);
ExpressionSystem.SetExpression(personaDefName, ExpressionType.Playful);
await Task.Delay(2000);
ExpressionSystem.SetExpression(personaDefName, ExpressionType.Happy);
```

### **3. 好感度专属表情**

```csharp
// 高好感度（>800）时，调皮表情出现频率更高
if (affinity >= 800f)
{
    ExpressionSystem.PLAYFUL_PROBABILITY = 0.3f;  // 30%
}
```

---

## ?? **部署清单**

- [x] 添加 `ExpressionType.Playful` 枚举
- [x] 添加文件名后缀映射 `_playful`
- [x] 添加关键词检测逻辑
- [x] 更新 README.txt 模板
- [x] 编译并部署 DLL
- [ ] 为 Sideria 制作 `playful.png` 立绘
- [ ] 测试表情切换功能
- [ ] 验证日志输出

---

## ? **总结**

**调皮表情 (Playful) 已成功添加到表情系统！**

- **表情总数**: 从 10 个增加到 **11 个** ?
- **文件命名**: `playful.png` 或 `playful.jpg`
- **触发方式**: 手动设置 + 对话关键词自动检测
- **关键词**: 嘿嘿、嘻嘻、逗你、开玩笑、捉弄、调皮...

**下一步**：
1. 为现有人格（如 Sideria）制作调皮表情立绘
2. 测试表情切换功能
3. 根据实际效果调整关键词和触发逻辑

---

**制作人格立绘时，记得把 `playful.png` 放到表情文件夹中！** ??
