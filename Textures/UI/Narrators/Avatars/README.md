# UI按钮头像文件夹说明

## ?? 文件夹结构

```
Textures/UI/Narrators/Avatars/
├── Sideria/
│   ├── base.png          (512x512 基础头像)
│   ├── happy.png         (512x512 开心表情头像)
│   ├── happy1.png        (512x512 开心表情变体1)
│   ├── happy2.png        (512x512 开心表情变体2)
│   ├── sad.png           (512x512 悲伤头像)
│   ├── angry.png         (512x512 愤怒头像)
│   ├── shy.png           (512x512 害羞头像)
│   ├── shy1.png          (512x512 害羞变体1)
│   └── ...              (其他表情头像)
├── OtherPersona/
│   └── ...
└── README.md            (本文件)
```

## ?? 头像规格

- **尺寸**: 512x512 像素
- **格式**: PNG（支持透明）
- **内容**: 头部特写（脸部+肩膀）
- **比例**: 9:16 头像的上半部分

## ?? 文件命名规则

表情文件名**必须小写**，与表情类型对应：

| 表情类型 | 文件名 |
|---------|--------|
| Neutral | `base.png` |
| Happy | `happy.png` |
| Sad | `sad.png` |
| Angry | `angry.png` |
| Surprised | `surprised.png` |
| Worried | `worried.png` |
| Smug | `smug.png` |
| Disappointed | `disappointed.png` |
| Thoughtful | `thoughtful.png` |
| Annoyed | `annoyed.png` |
| Playful | `playful.png` |
| Shy | `shy.png` |

## ?? 与立绘的区别

| 用途 | 文件夹 | 尺寸 | 内容 |
|------|--------|------|------|
| **聊天界面立绘** | `9x16/Expressions/` | 1024x1824 | 全身立绘 |
| **UI按钮头像** | `Avatars/` | 512x512 | 头部特写 |

## ?? 使用方式

### 1. 自动降级（推荐）

如果**没有**头像文件，系统会自动从立绘裁剪头部：
- 从 `9x16/Expressions/` 加载立绘
- 裁剪上半部分（512x512）
- 用作UI按钮头像

### 2. 手动提供头像（最佳）

为了**最佳显示效果**，建议手动提供512x512头像：
1. 创建 `Textures/UI/Narrators/Avatars/{PersonaName}/` 文件夹
2. 放入对应表情的头像文件
3. 重启游戏即可看到效果

## ?? 示例：Sideria的头像

```
Textures/UI/Narrators/Avatars/Sideria/
├── base.png          # 基础头像
├── happy.png         # 开心表情头像
├── happy1.png        # 开心表情变体1
├── happy2.png        # 开心表情变体2
├── sad.png           # 悲伤表情头像
├── angry.png         # 愤怒表情头像
├── shy.png           # 害羞表情头像
└── shy1.png          # 害羞变体1
```

## ?? 技术说明

- **加载优先级**：
  1. 头像文件 (`Avatars/`)
  2. 立绘裁剪 (`9x16/Expressions/`)
  3. 占位符（渐变色）

- **缓存机制**：
  - 每个表情头像独立缓存
  - 缓存键：`{PersonaName}_avatar_{expression}`

- **性能优化**：
  - 自动裁剪只在首次加载时执行
  - 裁剪结果会缓存，避免重复计算

## ?? 最佳实践

1. **头像制作**：
   - 从立绘裁剪头部区域
   - 适当放大脸部细节
   - 保持与立绘风格一致

2. **文件大小**：
   - 建议 < 500KB
   - 使用PNG压缩工具优化

3. **透明背景**：
   - 推荐使用透明背景
   - 或使用与UI匹配的深色背景

## ?? 预期效果

### 聊天界面
- 使用 `9x16/Expressions/` 的全身立绘
- 显示完整人物形象

### UI按钮
- 使用 `Avatars/` 的头部特写
- 或自动裁剪立绘头部
- 显示脸部表情细节

## ?? 文件夹结构更新

```
Avatars/
└── Sideria/
    ├── base.png          → 基础头像 (512x512)
    ├── happy.png         → 开心表情头像
    ├── happy1.png        → ? 开心表情变体1（随机选择）
    ├── happy2.png        → ? 开心表情变体2（随机选择）
    ├── sad.png           → 悲伤表情头像
    ├── angry.png         → 愤怒表情头像
    ├── shy.png           → ? 新增：害羞表情头像
    ├── shy1.png          → ? 害羞表情变体1（可选）
    └── ...
```

## ?? 新增的表情说明

| 文件名 | 说明 | 变体支持 |
|--------|------|---------|
| `base.png` | 基础头像（无表情/中性） | ? |
| `happy.png` | 开心表情 | ? 支持 |
| `happy1.png` | 开心表情变体1 | ? 随机 |
| `happy2.png` | 开心表情变体2 | ? 随机 |
| `sad.png` | 悲伤表情 | ? 支持 |
| `sad1.png` | 悲伤表情变体1 | ? 随机 |
| `angry.png` | 愤怒表情 | ? 支持 |
| `surprised.png` | 惊讶表情 | ? 支持 |
| `worried.png` | 担忧表情 | ? 支持 |
| `smug.png` | 得意表情 | ? 支持 |
| `disappointed.png` | 失望表情 | ? 支持 |
| `thoughtful.png` | 沉思表情 | ? 支持 |
| `annoyed.png` | 烦躁表情 | ? 支持 |
| `playful.png` | 调皮表情 | ? 支持 |
| **`shy.png`** | **害羞表情** | **? 支持** |
| **`shy1.png`** | **害羞表情变体1** | **? 随机** |

## ? 表情变体系统

### 工作原理

与立绘系统相同，头像也支持**随机变体选择**：

```
切换到"开心"表情
    ↓
查找: happy.png, happy1.png, happy2.png, happy3.png...
    ↓
随机选择一个存在的文件
    ↓
显示选中的头像变体
```

### 支持的变体数量

- **最多 5 个变体**：基础 + 变体1~5
- **变体可选**：不是所有表情都需要变体
- **随机触发**：每次切换表情时重新随机

### 示例

```
happy.png     → 微笑
happy1.png    → 眯眼笑
happy2.png    → 大笑
happy3.png    → 抿嘴笑
```

**效果**：每次显示开心头像时，从这4个中随机选一个！

## ? 新增：害羞表情

### 触发条件

- 对话包含：**害羞、不好意思、脸红、感谢、谢谢**
- 对话包含：**那个、嗯嗯、唔、诶**（语气词）
- 好感度变化

### 文件命名

```
shy.png       → 基础害羞头像
shy1.png      → 害羞变体1（可选）
shy2.png      → 害羞变体2（可选）
```

### 设计建议

- **面部特征**：微红脸颊、眼神飘移、嘴角微翘
- **变体差异**：可以有不同的害羞程度
  - `shy.png`：轻微害羞
  - `shy1.png`：捂脸害羞
  - `shy2.png`：低头害羞

## ?? 快速开始

1. 准备基础头像 `base.png` (512x512)
2. 绘制表情头像：
   ```
   happy.png       → 开心
   happy1.png      → 开心变体1（可选）
   sad.png         → 悲伤
   angry.png       → 愤怒
   shy.png         →害羞
   ```
3. 放入文件夹：`Textures/UI/Narrators/Avatars/Sideria/`
4. 重启游戏测试

## ?? 注意事项

- 文件名必须**全小写**
- PNG 格式
- 尺寸应为 512x512
- 如果缺少某个表情，系统会自动降级
- 变体文件**可选**，不强制要求
- 随机变体每次切换表情时才触发
- 头像和立绘的变体选择是**同步**的（使用相同的随机算法）

## ?? 设计建议

### 头部构图

```
┌─────────────┐
│   头顶留白   │  ← 10% 空间
├─────────────┤
│             │
│   面部特写   │  ← 80% 空间
│   (主要内容) │
│             │
├─────────────┤
│   肩部留白   │  ← 10% 空间
└─────────────┘
```

### 表情重点

- **眼睛**：占画面 30-40%
- **嘴巴**：清晰表达情绪
- **面部细节**：如脸红、皱眉等

---

**详细说明**：查看立绘文件夹的 README

**表情系统**：查看 `Expressions/Sideria/README.md`
