# 通用姿态系统 - 快速启动指南 v1.6.63

## ?? 3步快速开始

### 步骤 1：打开文档

```powershell
code 通用姿态系统-重构指南-v1.6.63.md
code Source\TheSecondSeat\UI\FullBodyPortraitPanel.cs
```

### 步骤 2：修改代码（6个修改点）

#### ? 修改点 1：添加 using

在文件顶部，找到：
```csharp
using System.Collections.Generic;
```

在其后添加：
```csharp
using System; // ? 添加
```

#### ? 修改点 2：添加姿态系统字段

在常量定义后（`FAST_FLASH_INTERVAL` 之后），添加：

```csharp
// ==================== ? 通用姿态系统字段 ====================

private string overridePosture = null;
private string activeEffect = null;
private Action onAnimationComplete = null;
private float animationTimer = 0f;
private float animationDuration = 0f;
private bool isPlayingAnimation = false;
```

#### ? 修改点 3：添加公共接口方法

在构造函数后，添加（完整代码见重构指南）：

```csharp
// ==================== ? 通用姿态系统公共接口 ====================

public void TriggerPostureAnimation(...) { ... }
public void StopAnimation() { ... }
```

#### ? 修改点 4：修改 Draw() 方法

在 `Draw()` 方法开头，添加：

```csharp
public void Draw()
{
    // ? 更新动画计时器
    UpdateAnimation();
    
    // 原有代码...
}
```

并添加 `UpdateAnimation()` 辅助方法。

#### ? 修改点 5：修改 DrawPortraitContents() 方法

5个关键修改（详见重构指南）：
1. Alpha 计算逻辑（添加动画检查）
2. 呼吸动画控制（动画中禁用）
3. 特效层绘制
4. 交互处理条件
5. 工具提示条件

#### ? 修改点 6：修改 DrawLayeredPortraitRuntime() 方法

在方法开头添加姿态检查逻辑（详见重构指南）。

### 步骤 3：编译部署

```powershell
.\编译并部署到游戏.ps1
```

---

## ?? 参考文档

| 文档 | 用途 |
|------|------|
| `通用姿态系统-重构指南-v1.6.63.md` | **完整实现指南**（必读）|
| `通用姿态系统-快速参考-v1.6.63.md` | 快速参考卡片 |
| `通用姿态系统-最终部署报告-v1.6.63.md` | 状态总结 |

---

## ? 验证清单

修改完成后，确认：

- [ ] 文件包含 `using System;`
- [ ] 添加了 7个姿态系统字段
- [ ] 添加了 2个公共接口方法
- [ ] `Draw()` 调用 `UpdateAnimation()`
- [ ] `DrawPortraitContents()` 有5处修改
- [ ] `DrawLayeredPortraitRuntime()` 添加姿态检查
- [ ] 编译通过（无错误）
- [ ] 部署成功

---

## ?? 完成后的功能

```csharp
// 触发姿态动画
var panel = PortraitOverlaySystem.GetPortraitPanel();
panel.TriggerPostureAnimation("body_arrival", "glitch_circle", 3.0f);
```

---

**预计时间：** 30-45分钟  
**难度：** ???☆☆（中等）  

祝您顺利完成！??
