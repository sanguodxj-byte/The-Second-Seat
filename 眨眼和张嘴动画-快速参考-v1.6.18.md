# 眨眼和张嘴动画 - 快速参考 v1.6.18

## ? 核心要点

**眨眼和张嘴动画已完全实现并适配分层立绘系统！**

---

## ?? 快速检查清单

### 眨眼动画
- [ ] 立绘眼睛自动眨动（3-6秒周期）
- [ ] 3帧平滑过渡（open → half → closed）
- [ ] 不同表情有不同频率

### 张嘴动画
- [ ] 播放 TTS 时嘴巴开合
- [ ] 4种嘴型自动切换
- [ ] 与表情系统配合

### 纹理资源
- [ ] 准备 7 个必需文件（eyes_* + mouth_*）
- [ ] 尺寸 1024x1574，PNG 格式
- [ ] 像素级对齐

---

## ?? 核心代码

### 1. 眨眼动画
```csharp
// 获取当前眨眼层
string blinkLayer = BlinkAnimationSystem.GetBlinkLayerName(personaDefName);
// 返回: "eyes_open" / "eyes_half" / "eyes_closed"
```

### 2. 张嘴动画
```csharp
// 获取当前嘴巴层
string mouthLayer = MouthAnimationSystem.GetMouthLayerName(personaDefName);
// 返回: "mouth_closed" / "mouth_smile" / "mouth_open_small" / "mouth_open_wide"
```

### 3. 分层合成适配
```csharp
// LayeredPortraitCompositor 自动应用动画层
config = ApplyAnimationLayers(config, blinkLayer, mouthLayer);
```

---

## ?? 必需文件

### 纹理资源
```
Textures/UI/Narrators/9x16/Layered/Sideria/
├── eyes_open.png          (睁眼)
├── eyes_half.png          (半闭眼)
├── eyes_closed.png        (闭眼)
├── mouth_closed.png       (闭嘴)
├── mouth_smile.png        (微笑)
├── mouth_open_small.png   (小张嘴)
└── mouth_open_wide.png    (大张嘴)
```

### 代码文件
```
Source/TheSecondSeat/PersonaGeneration/
├── BlinkAnimationSystem.cs          (新增)
├── MouthAnimationSystem.cs          (新增)
├── LayerDefinition.cs               (修改)
└── LayeredPortraitCompositor.cs     (修改)
```

---

## ?? 调试参数

| 参数 | 默认值 | 位置 |
|------|--------|------|
| 眨眼周期 | 3-6秒 | `BlinkAnimationSystem` |
| 眨眼时长 | 0.15秒 | `BLINK_DURATION` |
| 张嘴频率 | 8 Hz | `SPEAKING_FREQUENCY` |
| 更新间隔 | 30 ticks | `PORTRAIT_UPDATE_INTERVAL` |

---

## ?? 常见问题

### Q1: 眨眼不流畅？
**A:** 减小 `PORTRAIT_UPDATE_INTERVAL`（建议 15-30 ticks）

### Q2: 嘴巴不动？
**A:** 确认 TTS 正在播放，检查 `mouth_*.png` 文件是否存在

### Q3: 位置错位？
**A:** 使用图像编辑软件检查层对齐，确保尺寸一致（1024x1574）

### Q4: 性能下降？
**A:** 增大更新间隔或禁用 DevMode 日志

---

## ?? 部署步骤

```powershell
# 1. 运行部署脚本
.\Deploy-BlinkMouth-Animation-v1.6.18.ps1

# 2. 准备纹理文件
# 放入 Textures/UI/Narrators/9x16/Layered/{Persona}/

# 3. 启动游戏测试
# RimWorld → Mods → The Second Seat
```

---

## ?? 相关文档

- [眨眼和张嘴动画-纹理资源模板-v1.6.18.md](眨眼和张嘴动画-纹理资源模板-v1.6.18.md) - 纹理制作指南
- [眨眼和张嘴动画系统-完整实现报告-v1.6.18.md](眨眼和张嘴动画系统-完整实现报告-v1.6.18.md) - 完整技术文档
- [呼吸动画与分层立绘-快速参考-v1.6.18.md](呼吸动画与分层立绘-快速参考-v1.6.18.md) - 呼吸动画参考

---

**版本：** v1.6.18 | **状态：** ? 完成
