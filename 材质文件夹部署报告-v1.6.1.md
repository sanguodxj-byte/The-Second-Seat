# 材质文件夹部署报告 - v1.6.1

**日期**: 2025-01-26  
**版本**: v1.6.1 - 材质文件夹集成部署  
**状态**: ? 已完成

---

## ?? 部署内容

### 1. 源代码文件
- ? **ExpressionSystem.cs** - 表情系统核心
- ? **NarratorScreenButton.cs** - 触摸互动界面
- ? **PortraitLoader.cs** - 立绘加载器
- ? **AvatarLoader.cs** - 头像加载器

### 2. 材质文件夹（Textures）
- ? **UI/Narrators/9x16** - 全身立绘（1080x1920）
  - 19个PNG文件
  - 4个人格文件夹
- ? **UI/Narrators/Avatars** - UI按钮头像（512x512）
  - 10个PNG文件
  - 1个人格文件夹
- ? **UI/StatusIcons** - 状态指示灯
  - 2个PNG文件

**材质文件总计**: 40个PNG文件，18个文件夹

---

## ?? 更新的脚本

### Deploy-ExpressionVariants.ps1（增强版）

**新增功能**:
1. **材质文件夹自动部署** - 使用 robocopy 递归复制
2. **文件统计显示** - 实时显示部署的文件数量
3. **文件夹结构预览** - 显示关键文件夹的文件数量
4. **详细帮助信息** - 包含材质文件结构说明

**关键改进**:
```powershell
# 使用 robocopy 进行高效复制（保留目录结构）
$robocopyResult = robocopy $textureSourceDir $textureTargetDir /E /XO /NFL /NDL /NJH /NJS

# 统计文件数量
$textureCount = (Get-ChildItem $textureTargetDir -Recurse -File).Count

# 列出关键文件夹
$keyFolders = @(
    "UI\Narrators\9x16",
    "UI\Narrators\Avatars",
    "UI\StatusIcons"
)
```

---

## ?? 验证工具

### Verify-Textures-Deployment.ps1（新增）

**功能**:
1. ? 检查材质根目录
2. ? 验证关键文件夹结构
3. ? 列出所有人格立绘文件夹
4. ? 检查 base.png 是否存在
5. ? 统计表情文件数量
6. ? 检查表情变体文件（1-5）
7. ? 显示总体统计

**输出示例**:
```
? 材质根目录存在

?? 关键文件夹检查：
? 立绘文件夹（9:16全身像）
   PNG文件: 19 个
   子文件夹: 4 个

?? 已部署的人格立绘：
? Cassandra
   基础立绘: 存在
   表情文件: 0 个

?? 材质文件统计：
   PNG文件总数: 40
   文件夹总数: 18
```

---

## ?? 部署后的文件结构

```
D:\steam\steamapps\common\RimWorld\Mods\TheSecondSeat\
├── Source\
│   └── TheSecondSeat\
│       ├── PersonaGeneration\
│       │   ├── ExpressionSystem.cs        (? 已部署)
│       │   ├── PortraitLoader.cs          (? 已部署)
│       │   └── AvatarLoader.cs            (? 已部署)
│       └── UI\
│           └── NarratorScreenButton.cs    (? 已部署)
└── Textures\                              (? 已部署)
    └── UI\
        ├── Narrators\
        │   ├── 9x16\                      (立绘文件夹)
        │   │   ├── Cassandra\
        │   │   │   ├── base.png           (? 存在)
        │   │   │   └── Expressions\       (空)
        │   │   ├── Sideria\
        │   │   │   ├── base.png           (? 存在)
        │   │   │   └── Expressions\       (空)
        │   │   └── ...
        │   └── Avatars\                   (头像文件夹)
        │       └── Sideria\
        │           ├── base.png
        │           ├── happy.png
        │           └── ...
        └── StatusIcons\                   (状态图标)
            └── indicator.png
```

---

## ?? 材质文件要求

### 立绘文件（9:16）

**路径**: `Textures/UI/Narrators/9x16/{PersonaName}/`

| 文件 | 尺寸 | 说明 | 状态 |
|-----|------|------|------|
| `base.png` | 1080x1920 | 基础立绘（必需） | ? 已验证 |
| `Expressions/happy.png` | 1080x1920 | 开心表情基础版 | ?? 需添加 |
| `Expressions/happy1.png` | 1080x1920 | 开心表情变体1 | ?? 需添加 |
| `Expressions/happy2-5.png` | 1080x1920 | 开心表情变体2-5 | ?? 需添加 |
| `Expressions/sad.png` | 1080x1920 | 悲伤表情基础版 | ?? 需添加 |
| `...` | 1080x1920 | 其他表情同理 | ?? 需添加 |

### 头像文件（1:1）

**路径**: `Textures/UI/Narrators/Avatars/{PersonaName}/`

| 文件 | 尺寸 | 说明 | 状态 |
|-----|------|------|------|
| `base.png` | 512x512 | 基础头像（必需） | ? 已验证 |
| `happy.png` | 512x512 | 开心表情基础版 | ? 已存在 |
| `happy1-5.png` | 512x512 | 开心表情变体1-5 | ?? 需添加 |
| `...` | 512x512 | 其他表情同理 | ?? 需添加 |

---

## ?? 部署验证结果

### 成功部署
- ? 源代码文件: **4/4**
- ? 材质文件: **40个PNG**
- ? 文件夹结构: **完整**

### 待补充内容
- ?? **表情变体文件**: 0个（需要美术资源）
- ?? **Expressions 文件夹**: 空（需要添加表情PNG）

### 人格状态
| 人格 | 基础立绘 | 表情文件 | 头像 | 状态 |
|------|---------|---------|------|------|
| **Cassandra** | ? 存在 | 0个 | ? | ?? 缺头像 |
| **Sideria** | ? 存在 | 0个 | ? | ?? 缺表情 |
| **白牡丹** | ? 缺失 | 0个 | ? | ? 待创建 |
| **Expressions（误创建）** | ? | 0个 | ? | ?? 应删除 |

---

## ?? 使用指南

### 1. 部署命令
```powershell
# 完整部署（源文件 + 材质）
.\Deploy-ExpressionVariants.ps1

# 验证部署结果
.\Verify-Textures-Deployment.ps1
```

### 2. 添加新人格材质
```
1. 创建人格文件夹
   Textures/UI/Narrators/9x16/{新人格名}/

2. 放置基础立绘
   base.png (1080x1920)

3. 创建表情文件夹
   Expressions/

4. 放置表情文件
   happy.png, happy1.png ~ happy5.png
   sad.png, sad1.png ~ sad5.png
   ... (共12种表情)

5. 创建头像文件夹
   Textures/UI/Narrators/Avatars/{新人格名}/

6. 放置头像文件
   base.png, happy.png ~ happy5.png, ...
```

### 3. 测试流程
```
1. 运行部署脚本
2. 运行验证脚本
3. 启动 RimWorld
4. 加载游戏
5. 打开叙事者窗口
6. 测试表情切换
```

---

## ?? 美术资源需求

### 当前缺失
1. **所有表情变体文件** (12种表情 × 5个变体 = 60个文件/人格)
2. **白牡丹人格** 的所有材质
3. **Cassandra 人格** 的头像文件

### 优先级
| 优先级 | 内容 | 文件数量 | 状态 |
|--------|-----|---------|------|
| **P0** | Sideria 的 happy 表情变体 | 5个 | ?? 待制作 |
| **P1** | Sideria 的其他表情基础版 | 12个 | ?? 待制作 |
| **P1** | Cassandra 的所有头像 | 13个 | ?? 待制作 |
| **P2** | 所有表情变体 | 60个/人格 | ?? 待制作 |
| **P3** | 白牡丹全套材质 | 73个 | ?? 待创建 |

---

## ?? 注意事项

### 文件命名规范
```
? 正确:
   {PersonaName}_happy.png
   {PersonaName}_happy1.png
   {PersonaName}_happy2.png
   
? 错误:
   {PersonaName}_Happy.png     (大写H)
   {PersonaName} happy1.png    (空格)
   {PersonaName}_happy_1.png   (下划线分隔)
```

### 文件尺寸要求
```
立绘: 1080x1920 (9:16)
头像: 512x512   (1:1)
格式: PNG 24位 + Alpha通道
```

### 回退机制
```
系统会按以下顺序查找文件:
1. {Persona}_happy3.png       (具体变体)
2. {Persona}_happy.png        (基础版本)
3. {Persona}_base.png         (兜底)
4. placeholder.png            (最终回退)
```

---

## ?? 更新日志

### v1.6.1 (2025-01-26)
- ? 添加材质文件夹自动部署
- ? 创建材质验证工具
- ? 使用 robocopy 优化复制性能
- ? 添加详细的文件结构说明
- ? 显示实时部署进度

### v1.6.0 (2025-01-26)
- ? 表情变体系统实现
- ? 支持 1-5 个变体
- ? 触摸互动集成

---

## ?? 相关文档

- **表情变体系统实现报告.md** - 变体系统技术文档
- **立绘放置完整指南.md** - 立绘文件规范
- **表情文件快速参考.md** - 表情文件命名
- **v1.6.0-部署报告.md** - 初始部署报告

---

## ? 部署状态

- ? 部署脚本已更新
- ? 验证工具已创建
- ? 源文件已部署（4/4）
- ? 材质文件已部署（40个）
- ? 文件结构已验证
- ?? 表情变体待补充（美术资源）

---

**下次启动 RimWorld 时，游戏会自动编译新代码并加载材质文件。** ?

**当前状态**: 核心功能已完成，等待美术资源补充。 ??
