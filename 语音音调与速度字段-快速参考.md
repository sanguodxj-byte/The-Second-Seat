# 语音音调与速度字段-快速参考

## ? 修复完成

**时间：** 2025-01-XX  
**版本：** v1.6.12  
**修改文件：** `Source/TheSecondSeat/PersonaGeneration/NarratorPersonaDef.cs`  
**编译状态：** ? 成功 (0 warnings, 0 errors)

---

## ?? 新增字段

在 `NarratorPersonaDef` 类中添加了两个新的公共字段：

```csharp
// === 语音设置 ===
public string defaultVoice = "";  // 默认语音ID
public string voicePitch = "+0Hz";  // ? 新增：语音音调调整
public string voiceRate = "+0%";   // ? 新增：语音速度调整
```

**位置：** `defaultVoice` 字段之后

---

## ?? 用途

允许在 XML 人格定义文件中为每个人格自定义：
- **音调（Pitch）：** 控制声音的高低
- **语速（Rate）：** 控制说话的快慢

---

## ?? XML 使用示例

### 基本示例
```xml
<NarratorPersonaDef>
  <defName>MyPersona</defName>
  <narratorName>我的人格</narratorName>
  
  <!-- 语音设置 -->
  <defaultVoice>zh-CN-XiaoxiaoNeural</defaultVoice>
  <voicePitch>+0Hz</voicePitch>  <!-- 默认音调 -->
  <voiceRate>+0%</voiceRate>     <!-- 默认语速 -->
</NarratorPersonaDef>
```

### 提高音调示例（萝莉音）
```xml
<defaultVoice>zh-CN-XiaoyiNeural</defaultVoice>
<voicePitch>+50Hz</voicePitch>   <!-- 提高音调50Hz -->
<voiceRate>+0%</voiceRate>
```

### 降低音调示例（低沉音）
```xml
<defaultVoice>zh-CN-YunxiNeural</defaultVoice>
<voicePitch>-30Hz</voicePitch>   <!-- 降低音调30Hz -->
<voiceRate>+0%</voiceRate>
```

### 加快语速示例
```xml
<defaultVoice>zh-CN-XiaoxiaoNeural</defaultVoice>
<voicePitch>+0Hz</voicePitch>
<voiceRate>+20%</voiceRate>      <!-- 加快语速20% -->
```

### 综合调整示例
```xml
<defaultVoice>zh-CN-XiaoxiaoNeural</defaultVoice>
<voicePitch>+30Hz</voicePitch>   <!-- 稍微提高音调 -->
<voiceRate>+10%</voiceRate>      <!-- 稍微加快语速 -->
```

---

## ?? 参数范围

### voicePitch（音调）
- **格式：** `±数值Hz`
- **范围：** `-100Hz` 到 `+100Hz`
- **默认值：** `+0Hz`（不调整）
- **推荐范围：**
  - 女声提高：`+20Hz` 到 `+50Hz`
  - 男声降低：`-20Hz` 到 `-50Hz`

### voiceRate（语速）
- **格式：** `±数值%`
- **范围：** `-50%` 到 `+100%`
- **默认值：** `+0%`（不调整）
- **推荐范围：**
  - 稍慢：`-10%` 到 `-20%`
  - 稍快：`+10%` 到 `+20%`

---

## ?? 人格类型推荐配置

### 温柔型人格
```xml
<voicePitch>+20Hz</voicePitch>   <!-- 温柔的音调 -->
<voiceRate>-5%</voiceRate>       <!-- 稍慢的语速 -->
```

### 活泼型人格
```xml
<voicePitch>+30Hz</voicePitch>   <!-- 活泼的音调 -->
<voiceRate>+15%</voiceRate>      <!-- 较快的语速 -->
```

### 冷酷型人格
```xml
<voicePitch>-20Hz</voicePitch>   <!-- 低沉的音调 -->
<voiceRate>-10%</voiceRate>      <!-- 缓慢的语速 -->
```

### 专业型人格
```xml
<voicePitch>+0Hz</voicePitch>    <!-- 标准音调 -->
<voiceRate>+5%</voiceRate>       <!-- 稍快的语速 -->
```

---

## ?? 技术细节

### Azure TTS SSML 格式
这些参数最终会被转换为 Azure TTS 的 SSML 格式：

```xml
<speak version="1.0" xmlns="http://www.w3.org/2001/10/synthesis" xml:lang="zh-CN">
  <voice name="zh-CN-XiaoxiaoNeural">
    <prosody pitch="+30Hz" rate="+10%">
      你的对话内容
    </prosody>
  </voice>
</speak>
```

### 字段说明
- **voicePitch：** 直接映射到 SSML 的 `pitch` 属性
- **voiceRate：** 直接映射到 SSML 的 `rate` 属性
- **默认值：** 如果为空或 `+0`，则不添加 `<prosody>` 标签

---

## ?? 注意事项

### 1. 音调调整限制
- **过高：** `>+100Hz` 可能导致声音失真
- **过低：** `<-100Hz` 可能导致声音不自然
- **推荐：** 使用 `±50Hz` 范围内的值

### 2. 语速调整限制
- **过快：** `>+50%` 可能导致听不清
- **过慢：** `<-50%` 可能导致听起来很别扭
- **推荐：** 使用 `±20%` 范围内的值

### 3. 兼容性
- 仅适用于 **Azure Neural TTS**
- 其他 TTS 提供商可能不支持这些参数
- 如果 TTS 服务不支持，这些参数会被忽略

---

## ?? 测试方法

### 1. 基础测试
1. 修改人格 XML 文件，添加 `voicePitch` 和 `voiceRate`
2. 重启 RimWorld
3. 在设置中点击"测试 TTS"
4. 听音调和语速是否符合预期

### 2. 对比测试
创建两个相同人格，但使用不同的音调和语速：

**人格A（原始）：**
```xml
<voicePitch>+0Hz</voicePitch>
<voiceRate>+0%</voiceRate>
```

**人格B（调整）：**
```xml
<voicePitch>+30Hz</voicePitch>
<voiceRate>+10%</voiceRate>
```

分别测试并对比效果。

---

## ?? 文件位置

### 人格定义文件
```
Mods/TheSecondSeat/Defs/NarratorPersonaDefs_*.xml
```

### 示例文件
可以参考现有的人格定义文件：
- `NarratorPersonaDefs_Vanilla.xml` - 原版人格
- `NarratorPersonaDefs_Custom.xml` - 自定义人格

---

## ?? 更新现有人格

如果你已经有现有的人格定义，添加这两个字段即可：

```xml
<NarratorPersonaDef>
  <!-- 现有字段 -->
  <defName>ExistingPersona</defName>
  <narratorName>现有人格</narratorName>
  <defaultVoice>zh-CN-XiaoxiaoNeural</defaultVoice>
  
  <!-- ? 新增这两行 -->
  <voicePitch>+0Hz</voicePitch>
  <voiceRate>+0%</voiceRate>
  
  <!-- 其他现有字段... -->
</NarratorPersonaDef>
```

**注意：** 如果不添加，默认值为 `+0Hz` 和 `+0%`（不调整）

---

## ?? 总结

### ? 修复内容
- 在 `NarratorPersonaDef` 类中添加了 `voicePitch` 和 `voiceRate` 字段
- 解决了 XML 加载时的"未定义字段"错误

### ?? 好处
- 每个人格可以有独特的音调和语速
- 更好的角色区分度
- 更丰富的语音表现力

### ?? 使用方法
1. 在人格 XML 中添加 `voicePitch` 和 `voiceRate`
2. 重启游戏
3. 测试 TTS 效果
4. 根据需要调整参数

---

**修复完成！** ?  
**版本：** v1.6.12  
**状态：** 已编译，待部署  
