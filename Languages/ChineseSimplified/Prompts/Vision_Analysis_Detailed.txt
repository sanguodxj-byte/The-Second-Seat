{{- if snippets.has_context == "true" -}}
详细分析这个角色立绘，并提供一个完整的 JSON 响应。

**关键要求：characterDescription 字段必须使用中文撰写！**

{{ if snippets.selected_traits }}
**用户选择的特质：**
---
{{ snippets.selected_traits }}
---

{{ end }}
{{ if snippets.user_supplement }}
**用户提供的背景：**
---
{{ snippets.user_supplement }}
---

**关键指令：**
1. 上面的用户描述提供了角色的性格和行为。
2. 你必须分析图像来描述外观。
3. 在 characterDescription 中结合：
   - 视觉细节（来自图像）：发色、眼睛颜色、服装、姿态等
   - 性格特质（来自用户）：使用用户的描述
4. 不要与用户的性格描述相矛盾！
5. 你的任务是为性格添加视觉细节，而不是替换它。

**个性标签要求：**
6. 根据图像和用户描述，建议 3-6 个中文个性标签。
7. 示例：「温柔」「坚强」「爱撒娇」「病娇」「傲娇」「冷酷」
8. 如果用户选择的特质与分析匹配，请包含它们。

{{ end }}
{
  "dominantColors": [
    {"hex": "#RRGGBB", "percentage": 0-100, "name": "颜色名称（中文）"}
  ],
  "visualElements": ["元素1", "元素2", "元素3"],
  "characterDescription": "详细的300-500字外观描述和性格推断（中文）",
  "mood": "整体氛围（中文）",
  "suggestedPersonality": "Benevolent/Sadistic/Chaotic/Strategic/Protective/Manipulative",
  "styleKeywords": ["关键词1", "关键词2", "关键词3"],
  "personalityTags": ["标签1", "标签2", "标签3", ...],
  "phraseLibrary": [
    { "key": "HeadPat", "phrases": ["短语1", "短语2"] },
    { "key": "BodyPoke", "phrases": ["短语1", "短语2"] },
    { "key": "Greeting", "phrases": ["短语1", "短语2"] }
  ],
  "interactionZones": {
    "head": { "xMin": 0.0, "yMin": 0.0, "xMax": 1.0, "yMax": 0.3 },
    "body": { "xMin": 0.0, "yMin": 0.3, "xMax": 1.0, "yMax": 1.0 }
  }
}

**记住**：
- characterDescription 必须使用中文！
- personalityTags 必须使用中文！
- phraseLibrary 中的短语必须符合角色性格！
{{ if snippets.user_supplement }}
- 尊重用户的性格描述 - 添加视觉细节，不要替换！
{{ end }}
- 建议 3-6 个符合角色的个性标签
- 先关注视觉外观，再推断性格
- 300-500 字中文
- 只返回有效的 JSON

**交互区域（触摸系统关键！）：**
识别立绘中的头部和身体区域。
使用归一化坐标（0.0 到 1.0）：
  - 原点 (0,0) = 左上角
  - X: 0.0 = 左边缘，1.0 = 右边缘
  - Y: 0.0 = 上边缘，1.0 = 下边缘
提供边界矩形：
  - head: 覆盖脸部/头部区域
  - body: 覆盖躯干/身体区域（头部下方）
示例: head { xMin:0.25, yMin:0.0, xMax:0.75, yMax:0.20 }
{{- else -}}
详细分析这个角色立绘，并提供一个完整的 JSON 响应。

**关键要求：characterDescription 字段必须使用中文撰写！**

{
  "dominantColors": [
    {"hex": "#RRGGBB", "percentage": 0-100, "name": "颜色名称（中文）"}
  ],
  "visualElements": ["元素1", "元素2", "元素3"],
  "characterDescription": "详细的300-500字外观描述和性格推断（中文）",
  "mood": "整体氛围（中文）",
  "suggestedPersonality": "Benevolent/Sadistic/Chaotic/Strategic/Protective/Manipulative",
  "styleKeywords": ["关键词1", "关键词2", "关键词3"],
  "phraseLibrary": [
    { "key": "HeadPat", "phrases": ["短语1", "短语2"] },
    { "key": "BodyPoke", "phrases": ["短语1", "短语2"] },
    { "key": "Greeting", "phrases": ["短语1", "短语2"] }
  ],
  "interactionZones": {
    "head": { "xMin": 0.0-1.0, "yMin": 0.0-1.0, "xMax": 0.0-1.0, "yMax": 0.0-1.0 },
    "body": { "xMin": 0.0-1.0, "yMin": 0.0-1.0, "xMax": 0.0-1.0, "yMax": 0.0-1.0 }
  }
}

**characterDescription 的关键要求（必须使用中文！）：**

**第一部分：详细外观描述（40%）**

描述所有可见细节：
- **种族**：人类？精灵？龙人？兽人？机器人？
- **发型**：颜色、长度、样式、质感（如「丝滑的银色长发如瀑布般倾泻，用绯红丝带扎起」）
- **眼睛**：颜色、形状、表情（如「绯红的竖瞳，透露着智慧与危险」）
- **面部特征**：表情、年龄、伤疤、标记
- **身材**：体型、姿态、站姿
- **服装与盔甲**：
  * 主要服饰
  * 盔甲部件
  * 配饰
  * 材质与状态
- **特殊特征**：翅膀、尾巴、角、武器、魔法效果
- **整体印象**：姿态、光影、构图所传达的情绪

**第二部分：从外观推断性格（40%）**

从视觉线索推断特质：

**从表情与肢体语言**：
- 严肃的面容 → 内敛、有纪律、自制力强
- 自信的站姿 → 果断、经验丰富、有领导力
- 防备的姿态 → 谨慎、戒备、可能有过去的创伤
- 放松的表情 → 平易近人、友善、信任他人

**从服装与盔甲**：
- 重甲 → 重视防护、备战、有纪律
- 深色系 → 神秘、严肃、内向或隐秘
- 精致设计 → 注重细节、可能虚荣或注重地位
- 简约实用装备 → 实际、注重功能而非形式

**从武器与装备**：
- 明显的武器 → 准备战斗、果断、可能好斗
- 隐藏的武器 → 有策略、谨慎、偏好出其不意
- 魔法神器 → 博学、学术型、与古老智慧有联系
- 无武器 → 和平、信任他人、或依赖其他优势

**第三部分：对话与行为预测（20%）**

基于视觉分析预测：

**说话风格**：
- 「她可能用[冷静/热情/严厉/温柔]的语气说话」
- 「她的表情暗示[正式/随意/专业/诗意]的语言」
- 「她可能用[简洁命令/丰富描述/军事术语]来交流」

**情感表达**：
- 「很少在公开场合表现强烈情绪」或「情绪外露」
- 「谨慎控制的反应」或「冲动回应」

**互动风格**：
- 「与陌生人保持距离」或「立即热情友好」
- 「先观察再说话」或「主动发起对话」

**记住**：
- characterDescription 必须使用中文！
- 要具体：不要只说「盔甲」 - 描述材质、状态、设计
- 从每个细节推断性格
- 预测行为：她会如何说话？反应？互动？
- 300-500字
- 只返回有效的 JSON

**短语库要求：**
- 为每个类别生成 3-5 个短语：
  - "HeadPat"：被摸头时的反应（如害羞、开心、恼怒）
  - "BodyPoke"：被戳身体时的反应（如惊讶、防备）
  - "Greeting"：玩家加载游戏时的问候语

**交互区域要求（关键！）：**
- 识别立绘中的头部区域和身体区域
- 使用归一化坐标（0.0 到 1.0）：
  * 原点(0,0)在图像左上角
  * X轴：0.0 = 左边缘，1.0 = 右边缘
  * Y轴：0.0 = 上边缘，1.0 = 下边缘
- 为每个区域提供边界矩形：
  * xMin：左边界（0.0-1.0）
  * yMin：上边界（0.0-1.0）
  * xMax：右边界（0.0-1.0）
  * yMax：下边界（0.0-1.0）
- HEAD 区域：应覆盖角色的脸部/头部区域
- BODY 区域：应覆盖角色的躯干/身体区域（不含头部）
- 典型立绘示例：
  * head: { "xMin": 0.25, "yMin": 0.0, "xMax": 0.75, "yMax": 0.20 }
  * body: { "xMin": 0.15, "yMin": 0.25, "xMax": 0.85, "yMax": 0.95 }

重点关注：
- 前 3-4 个主要颜色及其准确占比
- 立绘中所有可见的视觉元素
- 详细的外观分析（中文！）
- 从视觉线索推断性格（中文！）
- 行为预测（中文！）
- 系统提示词的风格关键词（中文）
- 互动短语库（HeadPat、BodyPoke、Greeting）
- 交互区域及其准确的归一化坐标
{{- end -}}