# 立绘自动分割 - 快速参考卡

## ?? 核心概念

**使用完整立绘，系统自动从脖子分割和组合**

---

## ?? 文件结构

### ? 新方法（完整立绘）
```
所有文件都是 1080x1920 的完整立绘！

9x16/Cassandra/
├─ base.png              ← 完整立绘（基础）

9x16/Expressions/Cassandra/
├─ happy.png             ← 完整立绘（头部表情不同）
├─ sad.png               ← 完整立绘（头部表情不同）
└─ angry.png             ← 完整立绘（头部表情不同）

9x16/Cassandra/Outfits/
├─ warm_1.png            ← 完整立绘（服装不同）
├─ warm_2.png            ← 完整立绘（服装不同）
└─ intimate_1.png        ← 完整立绘（服装不同）

? 不需要透明背景！
? 不需要手动抠图！
? 直接使用完整立绘！
```

### ? 旧方法（需要透明）
```
需要手动抠图：
- happy.png（只有头部，背景透明）← 费时费力
- warm_1.png（只有服装，背景透明）← 需要抠图
```

---

## ?? 自动分割原理

### 分割示意图
```
┌─────────────────┐
│    头部区域     │ ← 从表情差分提取
│   (0% - 30%)    │    happy.png
├─────────────────┤ ← 脖子位置（分割线）
│                 │
│    身体区域     │ ← 从基础立绘提取
│   (30% - 100%)  │    base.png
│                 │    + 服装叠加
│                 │    warm_1.png
└─────────────────┘

最终效果 = 头部（表情）+ 身体 + 服装
```

---

## ?? 分割参数

| 角色 | 分割线位置 | 羽化宽度 | 说明 |
|------|-----------|---------|------|
| **默认** | 30% | 10px | 标准脖子位置 |
| **Cassandra** | 28% | 12px | 脖子稍高 |
| **Phoebe** | 32% | 10px | 脖子稍低 |

### 参数说明
- **分割线位置**: 从顶部的百分比（0.0 - 1.0）
- **羽化宽度**: 平滑过渡的像素数

---

## ?? 羽化效果对比

### 不启用羽化
```
┌────────┐
│  头部  │
├────────┤ ← 生硬的切割线
│  身体  │
└────────┘
```

### 启用羽化（推荐）
```
┌────────┐
│  头部  │
│~~~~~~~~│ ← 平滑过渡区域
│  身体  │
└────────┘
```

---

## ??? 制作流程

### Step 1: 基础立绘
```
1. 绘制完整立绘
2. 保存: base.png (1080x1920)
3. 放置: 9x16/Cassandra/base.png
```

### Step 2: 表情差分
```
1. 复制 base.png
2. 只修改头部表情（其他不变）
3. 保存: happy.png
4. 放置: 9x16/Expressions/Cassandra/happy.png

? 完整立绘！不需要抠图！
```

### Step 3: 服装差分
```
1. 复制 base.png
2. 只修改服装（头部不变）
3. 保存: warm_1.png
4. 放置: 9x16/Cassandra/Outfits/warm_1.png

? 完整立绘！不需要抠图！
```

---

## ?? 组合示例

### 示例 1: 快乐表情 + 温暖服装
```
文件准备:
- base.png（基础立绘）
- happy.png（头部表情快乐）
- warm_1.png（身体穿温暖服装）

自动合成:
┌─────────┐
│ ?? 快乐 │ ← 从 happy.png 提取头部
├─────────┤
│         │
│ ?? 温暖 │ ← 从 warm_1.png 提取服装
│         │
└─────────┘

结果: 穿着温暖服装的快乐 Cassandra
```

### 示例 2: 悲伤表情 + 亲密服装
```
文件:
- base.png
- sad.png（头部表情悲伤）
- intimate_1.png（亲密服装）

结果:
┌─────────┐
│ ?? 悲伤 │ ← sad.png 头部
├─────────┤
│ ?? 亲密 │ ← intimate_1.png 服装
└─────────┘
```

---

## ?? 代码调用

### 自动合成
```csharp
// 系统自动调用，无需手动
Texture2D result = PortraitSplitter.ComposePortrait(
    baseTexture,        // 基础立绘
    expressionTexture,  // 表情差分（完整）
    outfitTexture,      // 服装差分（完整）
    "Cassandra_Classic" // 人格名称
);
```

### 调试预览
```csharp
// 保存分割线预览（红线标记分割位置）
PortraitSplitter.SaveSplitPreview(texture, "Cassandra_Classic");

// 输出位置:
// SaveData/TheSecondSeat/Cassandra_Classic_split_preview.png
```

---

## ?? 调整分割线

### 在 PortraitSplitter.cs 中修改
```csharp
case "Cassandra_Classic":
    return new PortraitSplitConfig
    {
        horizontalSplitY = 0.28f,  // ← 分割线位置
        featherWidth = 12,         // ← 羽化宽度
        enableFeathering = true    // ← 启用羽化
    };
```

### 分割线位置参考
```
0.20 = 顶部 20%（太高，会切到脸）
0.25 = 顶部 25%（稍高）
0.30 = 顶部 30%（标准，脖子）? 推荐
0.35 = 顶部 35%（稍低）
0.40 = 顶部 40%（太低，会露出服装）
```

---

## ? 制作要点

### 必须遵守
```
? 所有文件尺寸一致（1080x1920）
? 人物位置一致
? 只修改需要变化的部分
```

### 避免
```
? 不要改变人物姿势
? 不要移动人物位置
? 不要裁剪或缩放
```

---

## ?? 优势总结

| 对比项 | 旧方法（透明差分） | 新方法（自动分割） |
|-------|------------------|------------------|
| **制作难度** | ???? 需要抠图 | ? 直接保存完整图 |
| **边缘质量** | ?? 可能有锯齿 | ? 羽化平滑 |
| **文件格式** | 必须 PNG（透明） | PNG/JPG 都可 |
| **组合灵活性** | ? 灵活 | ? 更灵活 |
| **性能开销** | ?? 中等 | ?? 中等 |

---

## ?? 测试清单

- [ ] 基础立绘显示正常
- [ ] 表情差分头部切换正确
- [ ] 服装差分身体切换正确
- [ ] 表情+服装组合无冲突
- [ ] 分割线位置准确（脖子）
- [ ] 羽化边缘平滑自然
- [ ] 无明显切割线
- [ ] 性能表现良好

---

## ?? 常见问题

### Q: 分割线在哪里？
**A**: 默认在脖子位置（顶部30%），可调整。

### Q: 需要透明背景吗？
**A**: 不需要！完整立绘即可。

### Q: 会有切割线吗？
**A**: 启用羽化后，边缘会平滑过渡，看不出切割线。

### Q: 性能如何？
**A**: 首次合成约50-100ms，之后使用缓存，几乎无开销。

---

## ?? 快速开始

```
1. 准备 3 个完整立绘:
   - base.png（基础）
   - happy.png（表情不同）
   - warm_1.png（服装不同）

2. 放置到对应文件夹

3. 启动游戏测试

? 完成！系统自动分割和组合！
```

---

**版本**: v1.0  
**状态**: ? 已实现  
**优势**: 无需抠图，完整立绘即可
