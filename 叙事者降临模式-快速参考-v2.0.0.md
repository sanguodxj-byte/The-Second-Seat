# 叙事者降临模式 - 快速参考 v2.0.0

## ?? 核心功能

**叙事者降临**：玩家可召唤叙事者以实体形式降临到地图，配合华丽入场动画和特效。

---

## ?? 已创建的文件

### ? 美术资源文件夹
```
Textures/UI/Narrators/Descent/
├── README.md                          # 主文档（完整规范）
└── Postures/
    └── README.md                      # 姿势详细说明
```

### ? 核心代码
```
Source/TheSecondSeat/Descent/
├── NarratorDescentSystem.cs           # 主控制器
├── DescentAnimationController.cs     # 动画控制器
└── DescentEffectRenderer.cs          # 特效渲染器
```

### ? 文档
```
叙事者降临模式-完整实现框架-v2.0.0.md    # 完整实现文档
叙事者降临模式-快速参考-v2.0.0.md        # 本文件
```

---

## ?? 快速使用

### 触发降临

```csharp
// 援助模式
NarratorDescentSystem.Instance.TriggerDescent(DescentMode.Assist);

// 袭击模式
NarratorDescentSystem.Instance.TriggerDescent(DescentMode.Attack);

// 检查是否可以降临
if (NarratorDescentSystem.Instance.CanTriggerDescent(mode, out string reason))
{
    // 可以降临
}
else
{
    // 显示原因
    Messages.Message(reason, MessageTypeDefOf.RejectInput);
}
```

### 获取状态

```csharp
// 冷却剩余时间（秒）
int cooldownSec = NarratorDescentSystem.Instance.GetCooldownRemaining();

// 是否已有叙事者小人
bool hasNarrator = NarratorDescentSystem.Instance.HasNarratorPawnOnMap();
```

---

## ?? 最小可用版本（MVP）

### 必需资源（40张，~80 MB）

#### 1. 降临姿势立绘（3张 × 1人格）
```
Postures/[PersonaName]/
├── descent_pose_ready.png       # 1024x1574
├── descent_pose_charging.png    # 1024x1574
└── descent_pose_casting.png     # 1024x1574
```

#### 2. 核心特效（8张）
```
Effects/
├── Assist/
│   ├── aura_healing_01.png      # 512x512
│   └── ground_circle_holy.png   # 1024x1024
├── Attack/
│   ├── aura_wrath_01.png        # 512x512
│   └── ground_circle_dark.png   # 1024x1024
└── Common/
    ├── impact_ground.png        # 1024x1024
    ├── smoke_dust.png           # 512x512
    └── energy_burst.png         # 512x512
```

#### 3. 简化动画（20帧关键帧）
```
Cinematic/DragonRider/
├── rider_approach_01-05.png     # 接近（5帧）
├── rider_circle_41-45.png       # 盘旋（5帧）
├── rider_landing_61-67.png      # 降落（7帧）
└── rider_dismount_91-93.png     # 下马（3帧）
```

#### 4. 小人三视图（4张）
```
Pawns/[PersonaName]/
├── front.png                    # 128x128
├── side.png                     # 128x128
├── back.png                     # 128x128
└── portrait.png                 # 128x128
```

#### 5. 巨龙召唤物（5张）
```
Summons/Dragon/
├── dragon_front.png             # 256x256
├── dragon_side.png              # 256x256
├── dragon_back.png              # 256x256
├── dragon_portrait.png          # 128x128
└── dragon_flying.png            # 512x512
```

---

## ?? 降临流程时间轴

```
0.0s  - 触发降临命令
0.5s  - 立绘切换到 descent_pose_ready
1.0s  - 立绘切换到 descent_pose_charging
2.0s  - 立绘切换到 descent_pose_casting
2.5s  - 特效爆发，立绘淡出
3.0s  - 过场动画开始（龙骑兵接近）
6.0s  - 龙骑兵降落
7.5s  - 叙事者下马
8.0s  - 降落特效播放
8.5s  - 叙事者小人生成
9.0s  - 巨龙召唤物生成
9.5s  - 特效光环浮现
10.0s - 降临完成
```

---

## ?? 触发条件

### 援助模式
- 好感度 ≥ 40
- 冷却时间已过（10分钟）
- 地图上无叙事者小人
- 有有效地图

### 袭击模式
- 好感度 > -100（总是可用）
- 冷却时间已过（10分钟）
- 地图上无叙事者小人
- 有有效地图

---

## ?? 美术规格速查

### 纹理尺寸
| 类型 | 尺寸 | 格式 |
|------|------|------|
| 降临姿势 | 1024x1574 | PNG-24 |
| 特效光环 | 512x512 | PNG-24 |
| 魔法阵 | 1024x1024 | PNG-24 |
| 粒子 | 256x256 | PNG-24 |
| 动画帧 | 1920x1080 | PNG-24 |
| 小人三视图 | 128x128 | PNG-24 |
| 召唤物 | 256x256 | PNG-24 |

### 色彩方案
```
援助模式：
  - 主色：金色 #FFD700、白色 #FFFFFF
  - 辅色：浅蓝 #87CEEB、淡黄 #FFEB3B

袭击模式：
  - 主色：深红 #DC143C、黑色 #1A1A1A
  - 辅色：暗紫 #4B0082、血红 #8B0000
```

---

## ?? 代码集成

### 在对话窗口添加按钮

```csharp
// 在 NarratorWindow.cs 的 DoWindowContents 中添加
private void DrawDescentButton(Rect rect)
{
    string buttonText = "? 叙事者降临";
    int cooldown = NarratorDescentSystem.Instance.GetCooldownRemaining();
    
    if (cooldown > 0)
    {
        GUI.enabled = false;
        buttonText = $"降临冷却中 ({cooldown}秒)";
    }
    
    if (Widgets.ButtonText(rect, buttonText))
    {
        // 打开模式选择对话框
        Find.WindowStack.Add(new Dialog_DescentModeSelection());
    }
    
    GUI.enabled = true;
}
```

### 添加到命令系统

```csharp
// 在 GameActionExecutor.cs 中添加
case "TriggerDescent":
    var mode = command.parameters.target == "Assist" 
        ? DescentMode.Assist 
        : DescentMode.Attack;
    
    bool success = NarratorDescentSystem.Instance.TriggerDescent(mode);
    return new ActionResult(success, success ? "降临启动" : "降临失败");
```

---

## ?? 故障排查

### 常见问题

**Q: 动画播放卡顿？**
```
解决方法：
1. 减少帧率（15 FPS → 12 FPS）
2. 压缩纹理（PNG → DXT5）
3. 预加载前30帧
```

**Q: 纹理找不到？**
```
检查：
1. 文件路径是否正确（小写 + 下划线）
2. 文件格式是否为 PNG
3. 文件是否在正确文件夹
```

**Q: 小人生成失败？**
```
解决方法：
1. 检查 PawnKindDef 配置
2. 使用原版小人测试
3. 查看 Player.log 日志
```

---

## ?? 开发优先级

### 第1周：核心功能
- [ ] 集成降临系统代码
- [ ] 制作1套姿势立绘（3张）
- [ ] 实现基础降临（无动画）

### 第2周：基础内容
- [ ] 制作核心特效（8张）
- [ ] 实现小人生成
- [ ] 添加降临效果

### 第3-4周：动画内容
- [ ] 制作20帧关键动画
- [ ] 实现动画播放
- [ ] 制作小人和召唤物图像

### 第5-6周：完善打磨
- [ ] 完成完整120帧动画
- [ ] 优化性能
- [ ] 添加音效

---

## ?? 相关文档

- **完整实现文档**：`叙事者降临模式-完整实现框架-v2.0.0.md`
- **美术资源规范**：`Textures/UI/Narrators/Descent/README.md`
- **姿势立绘详解**：`Textures/UI/Narrators/Descent/Postures/README.md`

---

## ? 快速测试

```csharp
// 在游戏控制台（DevMode）中输入：
// 触发援助降临
NarratorDescentSystem.Instance.TriggerDescent(DescentMode.Assist);

// 查看状态
Log.Message($"Cooldown: {NarratorDescentSystem.Instance.GetCooldownRemaining()}s");
Log.Message($"Has Narrator: {NarratorDescentSystem.Instance.HasNarratorPawnOnMap()}");
```

---

**准备好开始史诗级的开发之旅吧！** ?????
