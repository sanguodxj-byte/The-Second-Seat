# 分层立绘表情拆分系统 - 快速参考 v1.6.18

## ?? **核心概念**

**表情不再是完整图片，而是拆分为独立部件进行拼接！**

```
完整立绘 = base_body（底图） + eyes（眼睛） + mouth（嘴巴） + flush（脸红）
```

---

## ?? **文件结构**

```
Layered/{PersonaName}/
├── base_body.png          ← 底图（身体+默认表情）
└── 表情部件：
    ├── {expression}_eyes.png    ← 眼睛
    ├── {expression}_mouth.png   ← 嘴巴
    └── {expression}_flush.png   ← 脸红（可选）
```

**示例（Happy 表情）：**
```
├── base_body.png
├── happy_eyes.png
├── happy_mouth.png
└── happy_flush.png
```

---

## ?? **图层叠加顺序**

```
Priority  图层         文件名
--------  ----------  -------------------------
0         base_body   base_body.png              ← 最底层
10        outfit      outfit_{outfit}.png
20        flush       {expression}_flush.png
30        eyes        {expression}_eyes.png
40        mouth       {expression}_mouth.png
50        hair        hair.png
60        accessories accessories.png
```

---

## ?? **表情部件命名**

| 表情 | 眼睛 | 嘴巴 | 脸红（可选） |
|-----|------|------|------------|
| neutral | `neutral_eyes.png` | `neutral_mouth.png` | `neutral_flush.png` |
| happy | `happy_eyes.png` | `happy_mouth.png` | `happy_flush.png` |
| sad | `sad_eyes.png` | `sad_mouth.png` | - |
| angry | `angry_eyes.png` | `angry_mouth.png` | - |
| shy | `shy_eyes.png` | `shy_mouth.png` | `shy_flush.png` |

---

## ??? **制作流程（Photoshop）**

### **Step 1: 准备底图**
```
1. 创建 1024x1572 画布
2. 绘制身体 + 默认表情
3. 导出 → base_body.png
```

### **Step 2: 制作表情部件**
```
对于每个表情（如 happy）：
1. 新建图层 → 绘制眼睛 → 导出 happy_eyes.png
2. 新建图层 → 绘制嘴巴 → 导出 happy_mouth.png
3. （可选）新建图层 → 绘制脸红 → 导出 happy_flush.png
```

**注意：** 所有PNG必须是 1024x1572，部件图层的非绘制区域保持透明！

---

## ? **优势**

| 优势 | 说明 |
|-----|------|
| **文件大小** | 减少约50%（每个表情只需2-3个小文件） |
| **灵活性** | 可以独立修改眼睛、嘴巴、脸红 |
| **动画支持** | 支持独立的眨眼/张嘴动画 |
| **易维护** | 修改表情只需替换对应部件 |

---

## ?? **代码逻辑**

```csharp
// 1. 加载底图
Texture2D baseBody = LoadTexture("base_body.png");

// 2. 加载表情部件
Texture2D eyes = LoadTexture("happy_eyes.png");
Texture2D mouth = LoadTexture("happy_mouth.png");
Texture2D flush = LoadTexture("happy_flush.png");  // 可选

// 3. 按 Priority 叠加合成
FinalPortrait = baseBody + flush + eyes + mouth + hair;
```

---

## ?? **常见问题**

### **Q: 部件对不齐？**
**A:** 确保所有PNG尺寸一致（1024x1572），使用参考线标记位置。

### **Q: 脸红层不显示？**
**A:** 检查文件名是否正确（`{expression}_flush.png`），不透明度建议50-70%。

### **Q: 可以不用脸红层吗？**
**A:** 可以！脸红层是可选的，系统会跳过不存在的图层。

---

## ?? **相关文档**

- [分层立绘表情拆分系统-v1.6.18.md](分层立绘表情拆分系统-v1.6.18.md) - 详细说明
- [Textures/UI/Narrators/9x16/Layered/README.md](Textures/UI/Narrators/9x16/Layered/README.md) - 纹理资源说明

---

**版本：** v1.6.18  
**Commit:** 716b0e2  
**状态：** ? 已完成代码修改，等待纹理资源
