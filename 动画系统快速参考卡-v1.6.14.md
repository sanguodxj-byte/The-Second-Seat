# 动画系统快速参考卡 v1.6.14

## ? 部署状态

**状态：** 完成 ?  
**版本：** v1.6.14  
**日期：** 2025-12-09

---

## ?? 一键测试

### 启动游戏

```
1. 启动 RimWorld
2. 确认 The Second Seat Mod 已加载
3. 进入任意存档
4. 观察右下角 AI 按钮
```

### 预期效果

| 效果 | 描述 | 时机 |
|------|------|------|
| **默认显示** | 中性表情（base.png） | 始终 |
| **眨眼动画** | 短暂闭眼（blink.png） | 每 3-6 秒，持续 0.15 秒 |
| **说话动画** | 张嘴表情（speaking.png） | TTS 播放时 |

---

## ?? 关键文件

### Mod 目录

```
D:\steam\steamapps\common\RimWorld\Mods\TheSecondSeat\
```

### 必需文件

| 文件 | 路径 | 状态 |
|------|------|------|
| DLL | `Assemblies\TheSecondSeat.dll` | ? 443 KB |
| Defs | `Defs\NarratorPersonaDefs.xml` | ? |
| base | `Textures\...\Sideria\base.png` | ? |
| blink | `Textures\...\Sideria\blink.png` | ? |
| speaking | `Textures\...\Sideria\speaking.png` | ? |

---

## ?? 动画配置

### XML 配置

```xml
<portraitPath>UI/Narrators/Avatars/Sideria/base</portraitPath>
<portraitPathBlink>UI/Narrators/Avatars/Sideria/blink</portraitPathBlink>
<portraitPathSpeaking>UI/Narrators/Avatars/Sideria/speaking</portraitPathSpeaking>
```

### 动画参数

| 参数 | 值 | 说明 |
|------|-----|------|
| 眨眼间隔 | 3-6 秒 | 随机 |
| 眨眼持续 | 0.15 秒 | 固定 |
| 优先级 | 眨眼 > 说话 > 默认 | 固定 |

---

## ?? 测试清单

### 基础测试

- [ ] 游戏启动成功
- [ ] Mod 加载无错误
- [ ] AI 按钮显示
- [ ] 显示中性表情

### 眨眼测试

- [ ] 等待 3-6 秒
- [ ] 观察到眨眼动画
- [ ] 持续约 0.15 秒
- [ ] 自动恢复

### 语音测试

- [ ] 发送消息
- [ ] TTS 播放
- [ ] 显示说话动画
- [ ] TTS 结束恢复

---

## ?? 快速验证

### 检查文件

```powershell
# 一键检查所有文件
Get-ChildItem "D:\steam\steamapps\common\RimWorld\Mods\TheSecondSeat\Textures\UI\Narrators\Avatars\Sideria\" -Include "base.png","blink.png","speaking.png" | Select-Object Name
```

### 预期输出

```
Name        
----        
base.png    
blink.png   
speaking.png
```

---

## ?? 核心代码

### 获取当前纹理

```csharp
// 在 UI 中使用
Texture2D texture = PortraitController.Instance.GetCurrentPortrait(personaDef);
```

### 动画逻辑

```
优先级: 眨眼 > 说话 > 默认
        ↓
[眨眼中？] → Yes → blink.png
    ↓ No
[说话中？] → Yes → speaking.png
    ↓ No
返回 base.png
```

---

## ?? 故障排除

### 问题 1: 没有眨眼

**原因：** `blink.png` 缺失

**解决：**
```powershell
Copy-Item "neutral.png" "blink.png"
```

### 问题 2: 说话无动画

**原因：** `speaking.png` 缺失

**解决：**
```powershell
Copy-Item "neutral.png" "speaking.png"
```

### 问题 3: 显示灰色

**原因：** `base.png` 缺失

**解决：**
```powershell
Copy-Item "neutral.png" "base.png"
```

---

## ?? 快速命令

### 重新部署

```powershell
.\Deploy-Animation-System.ps1
```

### 跳过编译

```powershell
.\Deploy-Animation-System.ps1 -SkipBuild
```

### 部署并启动

```powershell
.\Deploy-Animation-System.ps1 -OpenGameAfter
```

---

## ?? 优化建议

### 可选优化

1. **制作专用 speaking.png**
   - 基于 neutral.png
   - 修改嘴巴为微张

2. **转换 blink.jpg**
   - 使用图像软件
   - 转换为真正的 PNG

3. **添加更多表情**
   - happy.png
   - sad.png
   - angry.png

---

## ? 成功标志

### 部署成功

```
? 编译成功
? DLL 复制完成
? Defs 复制完成
? 纹理复制完成
? 所有必需文件就位
```

### 游戏测试成功

```
? Mod 加载成功
? AI 按钮显示
? 眨眼动画工作
? 语音同步工作
? 无错误日志
```

---

**快速参考完成！** ?

_The Second Seat Mod Team_
