# 聊天滚动修复 - 快速参考

## ?? 问题症状

```
? 拉到底部时最后一条消息显示不全
? 滚动条无法到达真正的底部
? 内容被截断
```

---

## ? 修复代码

在 `DrawChatHistory()` 方法中修改两处：

```csharp
// ? 修复1：底部 padding 从 80px 增加到 120px
contentHeight += 120f;  // 原来是 80f

// ? 修复2：viewRect 最小高度增加 50px 缓冲
var viewRect = new Rect(0, 0, innerRect.width - 20f, 
    Mathf.Max(contentHeight, innerRect.height + 50f));  // 原来是 innerRect.height
```

---

## ?? 部署步骤

### 1. 替换文件

```powershell
# 备份
Copy-Item "Source\TheSecondSeat\UI\NarratorWindow.cs" `
          "Source\TheSecondSeat\UI\NarratorWindow.cs.bak"

# 替换
Move-Item "Source\TheSecondSeat\UI\NarratorWindow_Fixed.cs" `
          "Source\TheSecondSeat\UI\NarratorWindow.cs" -Force
```

### 2. 编译

```powershell
cd Source
dotnet build TheSecondSeat.csproj
```

### 3. 测试

1. 打开叙事者窗口
2. 发送 10+ 条消息
3. 滚动到底部
4. **验证**：最后一条消息完整显示，底部有空白

---

## ?? 预期效果

### 修复前 ?
```
消息4（被截断
```

### 修复后 ?
```
消息4（完整显示）

（充足的底部空间）
```

---

## ?? 参数说明

| 参数 | 原值 | 新值 | 作用 |
|------|------|------|------|
| 底部 padding | 80px | 120px | 确保最后一条消息下方有空白 |
| viewRect 缓冲 | 0px | 50px | 补偿 UI 计算误差 |

---

**版本**: v1.6.18  
**状态**: ? 已修复
