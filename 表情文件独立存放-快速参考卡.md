# 表情文件独立存放 - 快速参考卡

## ?? 一分钟了解

### ? 新特性
**表情文件现在存放在独立的 `Expressions` 文件夹中**

---

## ?? 文件结构对比

### ? 旧结构（不推荐）
```
9x16/Cassandra/
├─ base.png
├─ happy.png    ← 干扰项
├─ sad.png      ← 干扰项
└─ angry.png    ← 干扰项

问题：选择立绘时看到 4 个文件，混乱
```

### ? 新结构（推荐）
```
9x16/Cassandra/
└─ base.png     ← 只有基础立绘！

9x16/Expressions/Cassandra/
├─ happy.png
├─ sad.png
└─ angry.png

优势：选择立绘时只看到 1 个文件，清爽！
```

---

## ?? 文件放置位置

| 文件类型 | 旧路径 | 新路径 | 状态 |
|---------|--------|--------|------|
| **基础立绘** | `9x16/Cassandra/base.png` | `9x16/Cassandra/base.png` | ? 不变 |
| **整图表情** | `9x16/Cassandra/happy.png` | `9x16/Expressions/Cassandra/happy.png` | ? 迁移 |
| **面部纹理** | `9x16/Cassandra/happy_face.png` | `9x16/Expressions/Cassandra/happy_face.png` | ? 迁移 |
| **分层表情** | `9x16/Cassandra/layers/...` | `9x16/Expressions/Cassandra/layers/...` | ? 迁移 |

---

## ?? 快速操作指南

### 方法 1: 手动创建（新项目推荐）
```
1. 创建文件夹：
   - 9x16/Cassandra/
   - 9x16/Expressions/Cassandra/

2. 放置文件：
   - 基础立绘 → 9x16/Cassandra/base.png
   - 表情文件 → 9x16/Expressions/Cassandra/happy.png

3. 启动游戏测试
```

### 方法 2: 迁移脚本（已有文件推荐）
```powershell
# 模拟运行（查看预览）
.\Reorganize-Expressions.ps1 -DryRun

# 实际执行迁移
.\Reorganize-Expressions.ps1
```

---

## ?? 加载优先级

系统自动降级，兼容旧路径：

```
1?? 新路径: Expressions/Cassandra/happy.png     ? 优先
2?? 旧路径: Cassandra/happy.png                 ??  兼容
3?? 降级:   Cassandra/base.png                  ?? 默认
4?? 占位符: 程序生成                             ?? 最终
```

---

## ?? 支持的表情

| 表情文件名 | 说明 | 示例 |
|-----------|------|------|
| `happy.png` | 快乐 | ?? |
| `sad.png` | 悲伤 | ?? |
| `angry.png` | 愤怒 | ?? |
| `surprised.png` | 惊讶 | ?? |
| `worried.png` | 担忧 | ?? |
| `smug.png` | 得意 | ?? |
| `disappointed.png` | 失望 | ?? |
| `thoughtful.png` | 沉思 | ?? |
| `annoyed.png` | 烦躁 | ?? |

---

## ? 验证清单

- [ ] 基础立绘在 `9x16/Cassandra/base.png` ?
- [ ] 表情文件在 `9x16/Expressions/Cassandra/` ?
- [ ] 文件名全小写 ?
- [ ] PNG 格式 ?
- [ ] 尺寸正确 (1080x1920) ?

---

## ??? 日志验证

### 成功加载新路径
```
[PortraitLoader] ? 从 Expressions 加载整图表情: UI/Narrators/9x16/Expressions/Cassandra/happy
```

### 降级到旧路径（兼容）
```
[PortraitLoader] ?? 从旧路径加载表情（请迁移到 Expressions 文件夹）: UI/Narrators/9x16/Cassandra/happy
```

### 使用基础立绘（降级）
```
[PortraitLoader] 表情加载失败，返回基础立绘: Cassandra
```

---

## ?? 常见问题

### Q: 必须迁移到新结构吗？
**A**: 不必须。旧路径仍然支持，但推荐迁移以获得更好的文件组织。

### Q: 迁移会影响游戏吗？
**A**: 不会。系统会自动降级到旧路径，确保兼容性。

### Q: 如何知道加载了哪个路径？
**A**: 查看游戏日志，会显示加载路径和降级信息。

### Q: 分层表情怎么办？
**A**: 同样迁移到 `Expressions/Cassandra/layers/`

---

## ?? 推荐工作流程

```
1. 新项目：直接使用新结构 ?
   └─ 创建 Expressions 文件夹，放置表情文件

2. 已有文件：运行迁移脚本 ??
   └─ .\Reorganize-Expressions.ps1

3. 测试验证：查看日志 ??
   └─ 确认从 Expressions 加载

4. 享受清爽的文件结构 ??
   └─ 选择立绘时不再混乱
```

---

## ?? 相关文档

- ?? **完整指南**: `表情文件独立存放方案-完整指南.md`
- ?? **代码修改**: `表情文件独立存放-代码修改完成报告.md`
- ?? **迁移脚本**: `Reorganize-Expressions.ps1`
- ?? **文件夹说明**: `Textures/UI/Narrators/9x16/README.md`

---

**版本**: v1.0  
**状态**: ? 已实现  
**创建时间**: 2025-01-XX
