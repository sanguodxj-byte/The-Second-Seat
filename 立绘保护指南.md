# ??? 立绘文件保护指南

## ? 问题诊断

你的立绘文件被部署脚本覆盖了！

### 问题原因

之前的部署脚本（`Quick-Deploy.ps1`、`Final-Deploy.ps1` 等）会执行：

```powershell
Copy-Item $texturesPath -Destination $targetMod -Recurse -Force
```

这会把工作区的 `Textures` 文件夹（包括**空的** `Narrators` 文件夹）复制到游戏目录，覆盖你放置的真实立绘。

---

## ? 解决方案

### 方案 1：使用智能部署脚本（推荐）

以后请使用 `Smart-Deploy.ps1`，它会**跳过 Narrators 文件夹**：

```powershell
.\Smart-Deploy.ps1
```

**特点**：
- ? 只复制 DLL 和翻译文件
- ? 复制 UI 纹理（按钮、图标）
- ? **跳过** `Textures/UI/Narrators/` 文件夹
- ? 保护你的真实立绘

---

### 方案 2：手动保护立绘（备份）

在每次部署前，先备份立绘：

```powershell
# 备份立绘
Copy-Item "D:\steam\steamapps\common\RimWorld\Mods\TheSecondSeat\Textures\UI\Narrators" `
          "C:\Backup\Narrators_$(Get-Date -Format 'yyyyMMdd_HHmmss')" `
          -Recurse

# 正常部署
.\Smart-Deploy.ps1

# 如果立绘被覆盖，从备份恢复
Copy-Item "C:\Backup\Narrators_*" `
          "D:\steam\steamapps\common\RimWorld\Mods\TheSecondSeat\Textures\UI\Narrators" `
          -Recurse -Force
```

---

### 方案 3：分离立绘存储（推荐）

把真实立绘放在**单独的文件夹**，部署后再复制：

```powershell
# 1. 创建立绘存储文件夹
$portraitStorage = "C:\RimWorld_Portraits\TheSecondSeat"
New-Item -ItemType Directory -Path $portraitStorage -Force

# 2. 把真实立绘放入此文件夹
# 文件名格式：cassandra_portrait.png, phoebe_portrait.png 等

# 3. 部署后自动复制立绘
.\Smart-Deploy.ps1

Copy-Item "$portraitStorage\*" `
          "D:\steam\steamapps\common\RimWorld\Mods\TheSecondSeat\Textures\UI\Narrators\" `
          -Force
```

---

## ?? 文件夹结构说明

### 工作区（开发环境）
```
C:\Users\Administrator\Desktop\rim mod\The Second Seat\
└── Textures\
    └── UI\
        ├── Narrators\          ← 只有 README.md（占位符文件夹）
        ├── Narrator\           ← 其他 UI 纹理
        └── StatusIcons\        ← 状态图标
```

**注意**：工作区的 `Narrators` 文件夹应该是**空的**（或只有 README），真实立绘**不应该**放在这里！

---

### 游戏目录（运行环境）
```
D:\steam\steamapps\common\RimWorld\Mods\TheSecondSeat\
└── Textures\
    └── UI\
        ├── Narrators\          ← ?? 真实立绘应该在这里
        │   ├── cassandra_portrait.png  (你的真实立绘)
        │   ├── phoebe_portrait.png     (你的真实立绘)
        │   └── randy_portrait.png      (你的真实立绘)
        ├── Narrator\
        └── StatusIcons\
```

---

## ?? 正确的工作流程

### 1. 开发阶段
```powershell
# 在工作区修改代码
# 编译 DLL
dotnet build -c Release
```

### 2. 部署阶段
```powershell
# 使用智能部署（保护立绘）
.\Smart-Deploy.ps1
```

### 3. 立绘管理
```powershell
# 方法 A：手动放置
# 直接把立绘 PNG 文件复制到游戏目录：
# D:\steam\steamapps\common\RimWorld\Mods\TheSecondSeat\Textures\UI\Narrators\

# 方法 B：使用独立存储（推荐）
# 在 C:\ 创建立绘库，部署后自动复制
```

---

## ?? 不要做的事情

? **不要**把真实立绘放在工作区  
? **不要**使用旧的部署脚本（`Quick-Deploy.ps1`、`Final-Deploy.ps1`）  
? **不要**手动复制整个 `Textures` 文件夹  

---

## ?? 立绘恢复步骤

如果你的立绘已经丢失：

### 步骤 1：找回原始立绘文件
- 检查你的下载文件夹
- 检查备份文件夹
- 或重新生成立绘

### 步骤 2：放回正确位置
```powershell
# 目标路径
$targetPath = "D:\steam\steamapps\common\RimWorld\Mods\TheSecondSeat\Textures\UI\Narrators\"

# 复制立绘文件
Copy-Item "你的立绘文件路径\*.png" -Destination $targetPath -Force
```

### 步骤 3：验证
```powershell
.\Verify-Portraits.ps1
```

应该看到：
```
? cassandra_portrait.png - 1.2 MB (真实立绘)
? phoebe_portrait.png - 0.8 MB (真实立绘)
? randy_portrait.png - 1.5 MB (真实立绘)
```

---

## ?? 最佳实践

### 1. 使用立绘库
```powershell
# 创建专用文件夹
C:\RimWorld_Portraits\TheSecondSeat\
  ├── cassandra_portrait.png
  ├── phoebe_portrait.png
  └── randy_portrait.png
```

### 2. 创建部署后钩子
在 `Smart-Deploy.ps1` 末尾添加：

```powershell
# 自动恢复立绘
$portraitLib = "C:\RimWorld_Portraits\TheSecondSeat"
if (Test-Path $portraitLib) {
    Copy-Item "$portraitLib\*" `
              "$gameMod\Textures\UI\Narrators\" `
              -Force
    Write-Host "? 立绘已恢复" -ForegroundColor Green
}
```

### 3. 版本控制
在 `.gitignore` 中添加：

```gitignore
# 不要提交真实立绘到 Git
Textures/UI/Narrators/*.png
!Textures/UI/Narrators/README.md
```

---

## ?? 快速命令

### 验证立绘
```powershell
.\Verify-Portraits.ps1
```

### 智能部署
```powershell
.\Smart-Deploy.ps1
```

### 备份立绘
```powershell
$timestamp = Get-Date -Format "yyyyMMdd_HHmmss"
Copy-Item "D:\steam\steamapps\common\RimWorld\Mods\TheSecondSeat\Textures\UI\Narrators" `
          "C:\Backup\Narrators_$timestamp" -Recurse
```

### 恢复立绘
```powershell
Copy-Item "C:\RimWorld_Portraits\TheSecondSeat\*" `
          "D:\steam\steamapps\common\RimWorld\Mods\TheSecondSeat\Textures\UI\Narrators\" `
          -Force
```

---

## ? 总结

| 文件夹 | 用途 | 应该包含 |
|--------|------|---------|
| **工作区** `Textures/UI/Narrators/` | 开发环境 | ? 只有 README.md |
| **游戏目录** `Textures/UI/Narrators/` | 运行环境 | ? 真实立绘 PNG |
| **立绘库** `C:\RimWorld_Portraits\` | 独立存储 | ? 立绘备份 |

**记住**：
- ? 使用 `Smart-Deploy.ps1`
- ? 立绘放在游戏目录，不放在工作区
- ? 定期备份立绘
- ? 使用独立立绘库

---

**下次部署前，请先运行**：
```powershell
.\Verify-Portraits.ps1  # 检查立绘是否存在
.\Smart-Deploy.ps1       # 智能部署（保护立绘）
.\Verify-Portraits.ps1  # 再次验证
```

这样你的立绘就不会丢失了！
