<?xml version="1.0" encoding="utf-8" ?>
<Defs>

  <!-- 
    基类定义，严格参照 KoelimeAnimalBase
    - 父类: BasePawn
    - 包含基础的 race, thingCategories, recipes, comps
  -->
  <ThingDef ParentName="BasePawn" Name="SideriaAnimalBase" Abstract="True">
    <statBases>
      <ToxicResistance>1</ToxicResistance>
    </statBases>
    <race>
      <!-- ⭐ 使用战斗型 ThinkTree，让 Sideria 像龙一样主动追击敌人 -->
      <thinkTreeMain>Sideria_CombatThinkTree</thinkTreeMain>
      <thinkTreeConstant>Sideria_CombatThinkTree_Constant</thinkTreeConstant>
      <hasGenders>false</hasGenders> <!-- Sideria is genderless -->
      <bloodDef>Filth_Blood</bloodDef>
      <bloodSmearDef>Filth_BloodSmear</bloodSmearDef>
      <canBecomeShambler>false</canBecomeShambler>
      <renderTree>Sideria_SingleImage_RenderTree</renderTree> <!-- Keep our render tree -->
    </race>
    <thingCategories>
      <li>Animals</li>
    </thingCategories>
    <recipes>
      <li>ExciseCarcinoma</li>
      <li>RemoveBodyPart</li>
      <li>Euthanize</li>
      <li>Anesthetize</li>
      <li>CureScaria</li>
      <li MayRequire="Ludeon.RimWorld.Royalty">CureBloodRot</li>
    </recipes>
    <comps>
      <!-- ⭐ 自动使用技能（援助模式）- 更积极地使用唤龙和投掷 -->
      <li Class="TheSecondSeat.CompProperties_AutoAbility">
        <abilityDefs>
          <!-- 优先级顺序：唤龙（三种类型）> 投掷 > 猩红绽放 -->
          <li>Sideria_DragonGate_BloodThorn</li>
          <li>Sideria_DragonGate_Radiant</li>
          <li>Sideria_DragonGate_Mecha</li>
          <li>TSS_CalamityThrow</li>
          <li>Sideria_CrimsonBloom</li>
        </abilityDefs>
        <!-- 更频繁地检查（每2秒） -->
        <checkInterval>120</checkInterval>
        <!-- 更大的搜索范围 -->
        <searchRadius>35</searchRadius>
        <!-- 最多召唤3条龙 -->
        <maxSummonCount>3</maxSummonCount>
        <summonLimitDefName>Sideria_SpiritDragon</summonLimitDefName>
      </li>
      <li Class="TheSecondSeat.CompProperties_NarratorEntity">
        <disableSlaughter>true</disableSlaughter>
        <disableRelease>true</disableRelease>
        <hideTrainingTab>true</hideTrainingTab>
        <forceShowDraftGizmo>true</forceShowDraftGizmo>
      </li>
      
      <!-- 降临体通过 Pawn_SpawnSetup_Patch 注入原版 drafter 组件，不再需要自定义 CompDraftableAnimal -->
      <li Class="CompProperties_HoldingPlatformTarget" MayRequire="Ludeon.RimWorld.Anomaly">
        <baseEscapeIntervalMtbDays>120</baseEscapeIntervalMtbDays>
        <getsColdContainmentBonus>true</getsColdContainmentBonus>
      </li>
      <li MayRequire="Ludeon.RimWorld.Anomaly" Class="CompProperties_Studiable">
        <frequencyTicks>120000</frequencyTicks>
        <knowledgeCategory MayRequire="Ludeon.RimWorld.Anomaly">Basic</knowledgeCategory>
        <anomalyKnowledge>1</anomalyKnowledge>
        <requiresImprisonment>true</requiresImprisonment>
        <minMonolithLevelForStudy>1</minMonolithLevelForStudy>
      </li>
    </comps>
  </ThingDef>

  <!-- 
    Sideria 实例定义, 严格参照 KoelimeAnimal
  -->
  <ThingDef ParentName="SideriaAnimalBase">
    <defName>Sideria_DescentRace</defName>
    <label>Sideria Avatar</label>
    <description>The true divine form of Sideria. Her presence alone brings peace to allies and terror to enemies. Can be drafted and controlled directly.</description>
    <statBases>
      <!-- Sideria Specific Stats -->
      <MoveSpeed>8.0</MoveSpeed>
      <ComfyTemperatureMin>-200</ComfyTemperatureMin>
      <ComfyTemperatureMax>300</ComfyTemperatureMax>
      <MarketValue>0</MarketValue>
      <!-- 150% 护甲 -->
      <ArmorRating_Sharp>1.5</ArmorRating_Sharp>
      <ArmorRating_Blunt>1.5</ArmorRating_Blunt>
      <ArmorRating_Heat>1.5</ArmorRating_Heat>
      <ImmunityGainSpeed>2.0</ImmunityGainSpeed>
      <CarryingCapacity>250</CarryingCapacity>
      <PainShockThreshold>0.99</PainShockThreshold>
      <Wildness>0</Wildness>
      <CaravanRidingSpeedFactor>1.5</CaravanRidingSpeedFactor>
      <!-- 25% 承伤 (减少75%伤害) -->
      <IncomingDamageFactor>0.25</IncomingDamageFactor>
    </statBases>
    <uiIconScale>1.2</uiIconScale>
    <!-- Tools using native body part groups for humanlike body -->
    <tools>
      <li>
        <label>left hand</label>
        <capacities>
          <li>Scratch</li>
        </capacities>
        <power>25</power>
        <cooldownTime>1.5</cooldownTime>
        <linkedBodyPartsGroup>Hands</linkedBodyPartsGroup>
      </li>
      <li>
        <label>right hand</label>
        <capacities>
          <li>Scratch</li>
        </capacities>
        <power>25</power>
        <cooldownTime>1.5</cooldownTime>
        <linkedBodyPartsGroup>Hands</linkedBodyPartsGroup>
      </li>
      <li>
        <label>head</label>
        <capacities>
          <li>Bite</li>
        </capacities>
        <power>30</power>
        <cooldownTime>2</cooldownTime>
        <linkedBodyPartsGroup>FullHead</linkedBodyPartsGroup>
        <surpriseAttack>
          <extraMeleeDamages>
            <li>
              <def>Stun</def>
              <amount>20</amount>
            </li>
          </extraMeleeDamages>
        </surpriseAttack>
      </li>
    </tools>
    <race>
      <intelligence>Animal</intelligence>
      <body>Sideria_Body</body>
      <packAnimal>false</packAnimal> <!-- Disabled pack animal capability to prevent texture errors -->
      <baseHungerRate>0</baseHungerRate>
      <!-- 体型调整至1 -->
      <baseBodySize>1.0</baseBodySize>
      <!-- 血量倍率50倍，使部件血量约为2000 (如 Torso 40*50=2000) -->
      <baseHealthScale>50.0</baseHealthScale>
      <foodType>CarnivoreAnimal, OmnivoreHuman</foodType>
      <leatherDef IsNull="true" />
      <hasMeat>false</hasMeat>
      <trainability>None</trainability>
      <lifeExpectancy>9999</lifeExpectancy>
      <intelligence>Animal</intelligence>
      <neverIncludeInQuests>true</neverIncludeInQuests>
      <lifeStageAges>
        <li>
          <def>AnimalAdult</def>
          <minAge>0</minAge>
        </li>
      </lifeStageAges>
      <soundMeleeHitPawn>Pawn_Melee_BigBash_HitPawn</soundMeleeHitPawn>
      <soundMeleeHitBuilding>Pawn_Melee_BigBash_HitBuilding</soundMeleeHitBuilding>
      <soundMeleeMiss>Pawn_Melee_BigBash_Miss</soundMeleeMiss>
    </race>
  </ThingDef>

</Defs>
