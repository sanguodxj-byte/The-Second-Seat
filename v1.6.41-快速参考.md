# ?? v1.6.41 快速参考

## ?? 三大核心功能

### 1?? **Shift键激活系统**（防止立绘阻挡）
```
未按 Shift → 立绘半透明（alpha=0.2） → 点击穿透到地图
按住 Shift → 立绘完全显示（alpha=1.0） → 拦截交互事件
```

**使用方法**：
1. 默认状态：立绘半透明，可正常操作游戏
2. 想互动时：按住 **Shift** 键，立绘变为完全不透明
3. 头部摸摸：Shift + 鼠标拖拽头部区域
4. 身体戳戳：Shift + 单击身体区域

---

### 2?? **科幻对话文本库**（120条对话）
```
头部摸摸（3档 x 20条 = 60条）
  高好感（≥60）："（闭上眼睛）好温暖...像回到了母舰的休眠舱一样..."
  中立（-20~60）："（疑惑）这个动作...有什么特殊含义吗？"
  低好感（<-20）："（冷冷地推开）别碰我。"

身体戳戳（3档 x 20条 = 60条）
  高好感（≥60）："（活力满满）我在！需要我做什么吗？"
  中立（-20~60）："怎么了？"
  低好感（<-20）："（不耐烦）别烦我。"
```

**设计原则**：
- ? 科幻元素（母舰、传感器、能源补给）
- ? 现代科技（手机、网络、APP）
- ?? 自然角色驱动，非模因化

---

### 3?? **好感度待机表情**（5档映射）
| 好感度 | 表情 | 描述 |
|--------|------|------|
| > 80 | `Shy` | 暗恋/脸红 ?? |
| > 40 | `Happy` | 微笑 ?? |
| -20 ~ 40 | `Neutral` | 平静 ?? |
| -60 ~ -20 | `Sad` | 失望/冷淡 ?? |
| < -60 | `Angry` | 憎恨 ?? |

**特殊规则**：
- **心情覆盖**：心情极差时（Melancholic/Angry），强制使用 `Sad`
- **无限持续**：duration = 99999f（约41.7天），直到下次互动

---

## ?? 游戏内快速操作

### **启用立绘模式**
```
游戏设置 → Mod选项 → The Second Seat → 勾选"使用立绘模式"
```

### **立绘互动流程**
```
1. 立绘默认半透明（不阻挡游戏）
2. 按住 Shift 键（立绘变为完全显示）
3. 头部摸摸：拖拽头部区域（上方25%）→ 累积60点进度
4. 身体戳戳：单击身体区域（其余部分）→ 立即触发
5. 松开 Shift（立绘恢复半透明，表情保持）
```

---

## ??? 技术实现

### **Shift键检测**
```csharp
bool shiftHeld = Event.current.shift;
if (mouseOver && !shiftHeld)
{
    GUI.color = new Color(1f, 1f, 1f, 0.2f);  // 半透明
}
```

### **事件拦截**
```csharp
// HandleZoneInteraction 开头
if (!shiftHeld) return false;  // 未按 Shift，允许穿透
```

### **对话文本获取**
```csharp
// Source/TheSecondSeat/UI/InteractionPhrases.cs
string phrase = InteractionPhrases.GetHeadPatPhrase(affinity);
string phrase = InteractionPhrases.GetPokePhrase(affinity);
```

---

## ?? 好感度影响

| 好感度 | 头摸反应 | 戳戳反应 | 好感度变化 |
|--------|---------|---------|-----------|
| ≥60（高） | 害羞/开心 | 活力/积极 | +3 / +1 |
| -20~60（中） | 困惑/礼貌 | 平静/职业 | 无变化 |
| <-20（低） | 冷漠/拒绝 | 烦躁/敌意 | -1 / -0.5 |

---

## ??? 关键文件

```
新增：
Source/TheSecondSeat/UI/InteractionPhrases.cs  // 对话文本库

修改：
Source/TheSecondSeat/UI/FullBodyPortraitPanel.cs  // Shift键系统 + 互动逻辑
Source/TheSecondSeat/UI/NarratorScreenButton.cs   // 待机表情系统
```

---

## ? 测试清单

- [x] 未按 Shift：立绘半透明，点击穿透
- [x] 按住 Shift：立绘完全显示，拦截交互
- [x] 头部摸摸：60点进度 → 触发对话+表情
- [x] 身体戳戳：单击触发 → 对话+表情
- [x] 好感度映射：5档表情正确
- [x] 心情覆盖：Melancholic/Angry → Sad

---

## ?? 常见问题

### **Q1：立绘看不见？**
A：设置 → The Second Seat → 勾选"使用立绘模式"

### **Q2：按 Shift 没反应？**
A：确保鼠标在立绘区域内按住 Shift

### **Q3：对话文本不显示？**
A：头部摸摸需拖拽累积60点，身体戳戳需单击

### **Q4：立绘阻挡游戏操作？**
A：松开 Shift 键，立绘变为半透明，点击可穿透

---

## ?? 版本对比

| 功能 | v1.6.40 | v1.6.41 |
|------|---------|---------|
| 立绘阻挡问题 | ? 阻挡游戏 | ? Shift键激活 |
| 对话文本 | ?? 表情符号 | ?? 120条科幻对话 |
| 待机表情 | ? 固定Neutral | ? 5档好感度映射 |
| 互动反馈 | ? 无好感度影响 | ?? 好感度联动 |

---

## ?? 下一步计划

- [ ] 添加更多表情反馈文本（Shy、Confused、Smug等）
- [ ] 优化触摸进度条视觉效果
- [ ] 实现立绘自定义位置（拖拽）

---

**版本**：v1.6.41  
**状态**：? 编译成功，已部署  
**核心**：Shift键激活 + 120条对话 + 好感度待机表情
