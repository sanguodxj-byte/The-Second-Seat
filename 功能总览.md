# The Second Seat - 完整功能总览

## ?? 项目概述

**The Second Seat** 是一个先进的 RimWorld AI 叙事者助手，通过大语言模型（LLM）为玩家提供智能、个性化的游戏体验。

**核心理念**：从被动的故事生成器进化为主动的、有人格的 AI 伙伴。

---

## ?? 核心功能矩阵

| 功能模块 | 状态 | 亮点 | 文档 |
|---------|------|------|------|
| **?? 基础 AI 对话** | ? | LLM 集成，自然语言交互 | [README.md](README.md) |
| **?? 游戏命令执行** | ? | 12种高级命令，智能参数解析 | [完整使用手册.md](完整使用手册.md) |
| **?? 好感度系统** | ? | 18种影响因素，动态人格变化 | [好感度系统说明.md](好感度系统说明.md) |
| **?? 人格生成** | ? | 立绘+简介 → 自动人格分析 | [人格生成系统指南.md](人格生成系统指南.md) |
| **?? 多模态 API 分析** | ? | AI 视觉+文本深度理解 | [多模态API分析指南.md](多模态API分析指南.md) |
| **?? 网络搜索** | ? | 实时信息检索，3种搜索引擎 | [网络搜索功能说明.md](网络搜索功能说明.md) |
| **?? 事件系统** | ? | 好感度驱动事件，自动触发 | [ARCHITECTURE.md](ARCHITECTURE.md) |
| **?? 记忆系统** | ? | RimTalk 集成，长期记忆 | [ARCHITECTURE.md](ARCHITECTURE.md) |
| **?? 自主行为** | ? | AI 主动建议，智能干预 | [完整使用手册.md](完整使用手册.md) |

---

## ?? 人格生成系统（最新）

### 本地分析
- **颜色 → 人格映射**：红色→混乱，蓝色→战略，绿色→仁慈...
- **HSV 智能分析**：饱和度和明度的二次判断
- **关键词检测**：50+ 中英文关键词库
- **对话风格推断**：正式度、情感、话量、幽默、讽刺

### ?? 多模态 API 分析（新）
- **AI 视觉理解**：GPT-4 Vision / DeepSeek VL / Gemini Pro Vision
- **深度文本分析**：语义理解，非简单关键词匹配
- **智能融合**：图像 + 文本双重分析，置信度加权
- **自动图像搜索**：从游戏和 Mod 文件夹自动查找立绘
- **三大平台支持**：OpenAI（最准）/ DeepSeek（便宜）/ Gemini（免费）

### 内置人格
1. **Cassandra Classic** - 平衡战略型
2. **Phoebe Chillax** - 友善轻松型
3. **Randy Random** - 混乱随机型
4. **Igor Invader** - 施虐挑战型
5. **Luna Protector** - 保护守护型

### 快速使用
```
本地分析：游戏内 → AI 窗口 → "切换人格" → 选择 → 应用
API 分析：游戏内 → AI 窗口 → "切换人格" → 选择 → "使用 API 分析" → 等待 5-10秒
```

---

## ?? 好感度系统

### 影响因素（18种）

#### 实时触发
- ? 命令成功：+2.0
- ? 命令失败：-1.0
- ? 拒绝建议：-0.5

#### 定期监控（每100秒）
- ? 殖民者死亡：-5.0/人
- ? 新殖民者加入：+3.0/人
- ? 财富增长 >20%：+5.0
- ? 财富下降 >20%：-3.0
- ? 完美防御（无伤亡）：+8.0
- ? 成功击退袭击：+5.0
- ? 心情极佳 >80%：+1.0
- ? 心情低落 <30%：-1.0

#### 累计效果
- ? 连续7天繁荣：+10.0
- ? 连续7天灾难：-5.0
- ? 频繁互动（每10次）：+1.0
- ? 长时间冷落 >6小时：-1.0
- ? 多次忽略建议 ≥5次：-3.0

### 好感度等级
```
-100 ←─ Hostile ─ Cold ─ Neutral ─ Warm ─ Devoted ─ Infatuated ─→ 100
       -50      -10      30       60      85
```

### 影响效果
- **对话语气**：从冷淡到亲切
- **事件选择**：好感高 → 正面事件↑，负面事件↓
- **事件强度**：好感高 → 负面事件强度-30%
- **帮助意愿**：好感高 → 主动建议↑

---

## ?? 网络搜索功能

### 支持的搜索引擎
1. **DuckDuckGo** - 免费，无需 API Key（推荐新手）
2. **Bing** - 免费额度 1000次/月
3. **Google** - 免费额度 100次/天

### 自动触发条件
检测关键词：搜索、查找、什么是、最新、如何...

### 示例对话
```
玩家: "最新的 RimWorld 更新内容是什么？"

[系统自动搜索 DuckDuckGo]
[返回 3 个结果，总长 ≤800 字符]

AI: "根据最新信息，RimWorld 1.5 'Anomaly' 版本的主要新特性包括：
1. 新的异常生物和事件系统
2. 实体检测设备和研究内容
3. 改进的恐怖氛围机制

这些新内容可能会对你的殖民地带来全新的挑战哦！"
```

### 性能优化
- ? 60分钟缓存（相同查询直接返回）
- ? 异步处理（不阻塞游戏）
- ? 15秒超时
- ? 最多缓存 100 条

---

## ?? 游戏命令系统

### 高级命令（12种）

#### 生产管理
- **BatchHarvest** - 批量收获作物
- **BatchSow** - 批量种植
- **DesignatePlantCut** - 批量砍伐/清理

#### 战斗控制
- **BatchEquip** - 批量装备武器/护甲
- **EmergencyRetreat** - 紧急撤退
- **SetCombatStance** - 设置战斗姿态

#### 维护优化
- **PriorityRepair** - 优先修复
- **CleanupDebris** - 清理垃圾
- **ExtinguishFires** - 灭火

#### 医疗管理
- **TreatColonists** - 治疗殖民者
- **RescueIncapacitated** - 救援倒下的人

### 高级命令（14种）

#### 生产管理
- **BatchHarvest** - 批量收获作物
- **BatchSow** - 批量种植
- **DesignatePlantCut** - 批量砍伐/清理
- **BatchMine** - 批量采矿（支持目标过滤：all/metal/stone/component）

#### 战斗控制
- **BatchEquip** - 批量装备武器/护甲
- **BatchCapture** - 批量俘虏倒地敌人
- **EmergencyRetreat** - 紧急撤退
- **SetCombatStance** - 设置战斗姿态

#### 维护优化
- **PriorityRepair** - 优先修复
- **CleanupDebris** - 清理垃圾
- **ExtinguishFires** - 灭火

#### 医疗管理
- **TreatColonists** - 治疗殖民者
- **RescueIncapacitated** - 救援倒下的人

### 自然语言解析
```
玩家: "帮我收获所有成熟的作物"
→ 解析为：BatchHarvest(target: "Mature")
→ 执行成功 → 好感度 +2.0
```

---

## ?? 事件系统

### 好感度驱动事件

**高好感度（70+）**：
- 正面事件权重 ×1.35
- 负面事件权重 ×0.65
- 负面事件强度 -30%

**低好感度（-60）**：
- 正面事件权重 ×0.7
- 负面事件权重 ×1.3
- 负面事件强度 +30%

### 自动触发
- 每 10-50 分钟自动触发事件
- 根据好感度选择事件类型
- AI 生成事件评论

### 示例
```
好感度：80（Devoted）
→ 选择事件：贸易商队（正面）
→ AI 评论："看，我给你安排了一支商队！记得买点好东西哦~"
```

---

## ?? 记忆系统（RimTalk 集成）

### 记忆类型
- **对话记忆**：玩家和 AI 的交流
- **事件记忆**：殖民地重大事件
- **命令记忆**：执行的命令和结果

### 重要性分级
- **Critical**：殖民者死亡、连续繁荣
- **High**：成功防御、新成员加入
- **Medium**：日常对话、命令执行
- **Low**：常规事件

### 记忆召回
- 最近 10 条对话自动注入上下文
- 最近 5 条重要事件优先显示
- 总计 ≤500 tokens

---

## ?? 自主行为系统

### 主动建议
- **威胁预警**："检测到袭击即将来临，建议武装殖民者"
- **资源警告**："食物不足，建议增加种植面积"
- **优化建议**："发现多个受损建筑，需要修理吗？"

### 触发条件
- 资源短缺（食物 <50）
- 威胁即将来临
- 建筑需要维护
- 殖民者心情低落

### 玩家响应
- 接受 → 执行建议
- 拒绝 → 好感度 -0.5
- 忽略 → 累计 5 次 → -3.0

---

## ?? 技术架构

### 核心模块

```
TheSecondSeat/
├── Core/                       # 核心控制器
│   └── NarratorController.cs  # 主循环和对话管理
│
├── LLM/                        # AI 服务
│   ├── LLMService.cs          # LLM API 集成
│   └── LLMDataStructures.cs   # 数据结构
│
├── Narrator/                   # 叙事者管理
│   └── NarratorManager.cs     # 好感度和状态管理
│
├── PersonaGeneration/          # 人格生成（新）
│   ├── PersonaAnalyzer.cs     # 立绘和简介分析
│   └── SystemPromptGenerator.cs # Prompt 生成
│
├── WebSearch/                  # 网络搜索（新）
│   └── WebSearchService.cs    # 搜索引擎集成
│
├── Commands/                   # 命令系统
│   ├── IAICommand.cs          # 命令接口
│   └── ConcreteCommands.cs    # 具体实现
│
├── Events/                     # 事件系统
│   └── AffinityDrivenEvents.cs # 好感度事件
│
├── Monitoring/                 # 监控系统（新）
│   └── ColonyStateMonitor.cs  # 殖民地状态监控
│
├── Autonomous/                 # 自主行为
│   └── AutonomousBehaviorSystem.cs
│
├── Observer/                   # 游戏状态观察
│   └── GameStateObserver.cs
│
├── Integration/                # 外部集成
│   └── RimTalkIntegration.cs  # 记忆系统
│
└── UI/                         # 用户界面
    ├── NarratorWindow.cs      # 主窗口
    └── PersonaSelectionWindow.cs # 人格选择（新）
```

---

## ?? 文档索引

### 用户文档
1. **[README.md](README.md)** - 项目介绍和快速开始
2. **[快速入门.md](快速入门.md)** - 5分钟上手指南
3. **[完整使用手册.md](完整使用手册.md)** - 详细功能说明
4. **[好感度系统说明.md](好感度系统说明.md)** - 好感度机制详解
5. **[人格生成系统指南.md](人格生成系统指南.md)** - 人格创建教程（本地分析）
6. **[人格快速参考.md](人格快速参考.md)** - 速查卡
7. **[多模态API快速配置.md](多模态API快速配置.md)** - API 分析 5分钟配置
8. **[多模态API分析指南.md](多模态API分析指南.md)** - API 分析完整指南
9. **[网络搜索功能说明.md](网络搜索功能说明.md)** - 搜索功能指南
10. **[网络搜索快速配置.md](网络搜索快速配置.md)** - 5分钟配置

### 开发文档
1. **[ARCHITECTURE.md](ARCHITECTURE.md)** - 系统架构设计
2. **[DEVELOPMENT.md](DEVELOPMENT.md)** - 开发指南
3. **[TESTING.md](TESTING.md)** - 测试文档
4. **[人格系统实现总结.md](人格系统实现总结.md)** - 本地分析实现细节
5. **[多模态API实现总结.md](多模态API实现总结.md)** - API 分析实现细节
6. **[网络搜索工作流程.md](网络搜索工作流程.md)** - 搜索技术详解

---

## ?? 快速开始

### 1. 安装
```
1. 下载模组到 RimWorld/Mods/
2. 游戏内启用模组
3. 重启游戏
```

### 2. 配置
```
选项 → 模组设置 → The Second Seat

必选：
- API Endpoint: http://localhost:1234/v1/chat/completions
- Model Name: local-model

可选：
- 启用网络搜索（推荐 DuckDuckGo）
```

### 3. 使用
```
游戏内：
1. 选择任意殖民者
2. 点击"AI 旁白"按钮
3. 输入问题或命令
4. AI 回复并执行

切换人格：
1. 点击"切换人格"
2. 选择喜欢的人格
3. 点击"应用"
```

---

## ?? 最佳实践

### 提升好感度
1. **频繁互动** - 每天对话 10+ 次
2. **命令成功** - 确保有资源可执行
3. **保护殖民者** - 避免死亡
4. **稳定发展** - 财富稳步增长
5. **完美防御** - 战斗前充分准备

### 选择合适的人格
- **新手** → Phoebe Chillax（友善）
- **挑战** → Igor Invader（施虐）
- **平衡** → Cassandra Classic（战略）
- **随机** → Randy Random（混乱）
- **保护** → Luna Protector（守护）

### 高效使用命令
```
清晰表达：
? "帮我收获所有成熟的作物"
? "那个那个，东西"

提供上下文：
? "敌人即将来临，帮我武装所有殖民者"
? "帮我"

检查资源：
确保有武器、食物、材料等
```

---

## ?? 功能对比

### vs 原版叙事者
| 特性 | 原版 | The Second Seat |
|-----|------|-----------------|
| 事件生成 | ? | ? |
| 难度调整 | ? | ? |
| **自然语言对话** | ? | ? |
| **游戏命令执行** | ? | ? |
| **好感度系统** | ? | ? |
| **动态人格** | ? | ? |
| **网络搜索** | ? | ? |
| **记忆系统** | ? | ? |
| **主动建议** | ? | ? |

### vs 其他 AI 模组
| 特性 | 基础 AI 模组 | The Second Seat |
|-----|-------------|-----------------|
| LLM 集成 | ? | ? |
| 命令系统 | 部分 | ? 12种高级命令 |
| 人格系统 | ? | ? 立绘+简介生成 |
| 好感度 | ? | ? 18种影响因素 |
| 事件影响 | ? | ? 动态调整 |
| 网络搜索 | ? | ? 3种引擎 |
| 记忆整合 | ? | ? RimTalk |

---

## ?? 开发路线图

### v1.0（当前）
- ? 基础 AI 对话
- ? 游戏命令执行
- ? 好感度系统
- ? 人格生成
- ? 网络搜索
- ? 事件系统
- ? 记忆系统
- ? 自主行为

### v1.1（计划中）
- [ ] 立绘纹理加载
- [ ] 人格预览对话
- [ ] 更多内置人格（10+）
- [ ] 语音合成集成
- [ ] 多语言支持优化

### v2.0（未来）
- [ ] 动态人格演化
- [ ] AI 辅助人格生成
- [ ] 社区人格分享
- [ ] 多 AI 协作模式
- [ ] 深度学习事件预测

---

## ?? 贡献指南

### 报告 Bug
在 GitHub Issues 中提交，包含：
- RimWorld 版本
- 模组版本
- 错误日志
- 复现步骤

### 贡献代码
1. Fork 项目
2. 创建功能分支
3. 提交 Pull Request

### 创建人格
1. 编写 XML 定义
2. 测试对话效果
3. 分享到社区

---

## ?? 开源协议

MIT License - 自由使用、修改和分发

---

## ?? 致谢

- **Ludeon Studios** - RimWorld 游戏
- **LM Studio** - 本地 LLM 运行
- **OpenAI** - GPT API
- **社区贡献者** - 测试和反馈

---

## ?? 联系方式

- **GitHub**: [项目地址]
- **Discord**: [社区服务器]
- **Reddit**: r/RimWorld

---

**版本**: 1.0.0  
**最后更新**: 2024  
**开发团队**: TheSecondSeat Contributors

---

?? **立即体验智能叙事者的魅力！** ??
