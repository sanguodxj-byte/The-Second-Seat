# 呼吸动画 - 快速参考

## ?? 核心API

### 1. ExpressionState 属性

```csharp
// 呼吸动画参数
state.BreathingSpeed = 2f;        // 速度（默认）
state.BreathingIntensity = 4f;    // 强度（像素）
```

### 2. 获取呼吸偏移

```csharp
float offset = ExpressionSystem.GetBreathingOffset(personaDefName);
```

### 3. 应用到UI

```csharp
// 在绘制前调整Y坐标
portraitRect.y += breathingOffset;
GUI.DrawTexture(portraitRect, texture, ScaleMode.ScaleToFit);
```

---

## ?? 参数调整

| 参数 | 默认值 | 建议范围 | 效果 |
|------|--------|----------|------|
| BreathingSpeed | 2.0 | 1.0 - 5.0 | 呼吸频率 |
| BreathingIntensity | 4.0 | 2.0 - 10.0 | 移动幅度 |

### 预设效果

```csharp
// 平静呼吸
state.BreathingSpeed = 2f;
state.BreathingIntensity = 4f;

// 快速呼吸
state.BreathingSpeed = 4f;
state.BreathingIntensity = 6f;

// 深呼吸
state.BreathingSpeed = 1.5f;
state.BreathingIntensity = 8f;

// 禁用呼吸
state.BreathingIntensity = 0f;
```

---

## ?? 工作原理

```
偏移量 = sin(实时时间 × 速度) × 强度
      = sin(Time.realtimeSinceStartup × 2.0) × 4.0
      = -4.0 到 +4.0 像素
```

**周期计算**: `2π / Speed` 秒
- Speed = 2.0 → 周期 = 3.14 秒
- Speed = 3.0 → 周期 = 2.09 秒
- Speed = 1.0 → 周期 = 6.28 秒

---

## ?? 部署清单

### ? 文件修改
- [x] `ExpressionSystem.cs` - 添加呼吸参数和方法
- [x] `NarratorWindow.cs` - 应用呼吸偏移到立绘

### ? 功能验证
- [x] 立绘上下浮动
- [x] 名字标签固定
- [x] 暂停时仍工作
- [x] 性能无影响

---

## ?? 快速测试

```csharp
// 在游戏内控制台执行
var state = ExpressionSystem.GetExpressionState("Sideria_Default");
state.BreathingIntensity = 10f;  // 放大效果以便观察
```

---

**版本**: v1.6.17  
**状态**: ? 已完成
