# ? 分层立绘系统 - 快速参考 v1.6.27

## ?? 立绘未显示？检查清单

### ? 文件夹结构（已修复）
```
Textures\UI\Narrators\9x16\Layered\Sideria\
  ├── body.png              ? 必需
  ├── neutral_eyes.png      ? 必需
  ├── neutral_mouth.png     ? 必需
  ├── hair.png              ??  推荐
  └── background.png        ? 可选
```

### ? 当前问题
**立绘PNG文件缺失** - Sideria 文件夹下只有空的子文件夹

---

## ?? 快速修复步骤

### 步骤 1: 准备图层文件
使用图像编辑软件（Photoshop / GIMP）：
1. 打开完整立绘（1080×1920，9:16）
2. 拆分为独立图层：
   - **body.png** - 身体和服装
   - **neutral_eyes.png** - 眼睛和眉毛
   - **neutral_mouth.png** - 嘴巴
   - **hair.png** - 头发
3. 保存为PNG-32（透明背景）

### 步骤 2: 放置文件
```
D:\steam\steamapps\common\RimWorld\Mods\TheSecondSeat\
  Textures\UI\Narrators\9x16\Layered\Sideria\
    → 放置所有PNG文件到这里
```

### 步骤 3: 配置Def
```xml
<useLayeredPortrait>true</useLayeredPortrait>
```

### 步骤 4: 测试
1. 重启RimWorld
2. 加载存档
3. 打开AI旁白 → 立绘模式

---

## ?? 图层制作规范

| 属性 | 值 |
|------|---|
| 分辨率 | 1080×1920 |
| 格式 | PNG-32 |
| 透明 | 是 |
| 对齐 | 所有图层相同坐标系 |
| 大小 | < 500KB/图层 |

---

## ?? 诊断命令

```powershell
# 检查文件夹结构
powershell -ExecutionPolicy Bypass -File "Diagnose-Layered-Portraits-v1.6.27.ps1"

# 验证文件
Get-ChildItem "D:\steam\steamapps\common\RimWorld\Mods\TheSecondSeat\Textures\UI\Narrators\9x16\Layered\Sideria" -Filter "*.png"
```

---

## ?? 快速测试用图层

### 最小可工作配置
只需3个文件即可测试：
1. **body.png** - 包含整个立绘（作为基础）
2. **neutral_eyes.png** - 只有眼睛部分，其他透明
3. **neutral_mouth.png** - 只有嘴巴部分，其他透明

### 临时方案
如果暂时没有分层文件，可以：
1. 复制完整立绘为 `body.png`
2. 创建空白PNG（1×1透明像素）命名为 `neutral_eyes.png` 和 `neutral_mouth.png`
3. 这样至少能显示基础立绘

---

## ?? 图层叠加顺序

```
从底到顶：
1. background.png (可选)
2. body.png (必需)
3. hair_back.png (可选)
4. neutral_eyes.png (必需)
5. neutral_mouth.png (必需)
6. hair.png (推荐)
```

---

## ?? 常见错误

### 错误 1: 文件名大小写
? `Body.png`  
? `body.png`

### 错误 2: 图层尺寸不一致
? body.png (1080×1920), eyes.png (512×512)  
? 所有图层都是 1080×1920

### 错误 3: 图层未对齐
? 眼睛位置偏移  
? 使用相同坐标系导出

---

## ?? 需要帮助？

### 提供信息
1. 是否有完整立绘图片？
2. 使用什么图像编辑软件？
3. 图层拆分遇到什么困难？

### 我可以帮助
- 指导如何拆分图层
- 提供测试用简单图层
- 验证图层文件正确性

---

## ? 验证成功

当看到以下日志时，说明配置正确：
```
[LayeredPortraitCompositor] ? Composite created: Sideria (neutral, 5 layers)
[PortraitLoader] ? Layered portrait loaded: Sideria (neutral, default)
```

---

**版本**: v1.6.27  
**更新**: 2025-12-13  
**下一步**: 准备图层PNG文件 → 放置到Layered\Sideria\ → 重启游戏

?? **核心问题**: 图层PNG文件缺失，准备好后立即可用！
