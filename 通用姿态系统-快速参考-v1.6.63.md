# 通用姿态系统 - 快速参考 v1.6.63

## ?? 一句话总结

为全身立绘面板添加**姿态覆盖**和**特效叠加**功能，支持"实体化降临"等动态效果。

---

## ? 快速应用（3步）

```powershell
# 1. 应用重构（自动化脚本）
.\Apply-Posture-System-v1.6.63.ps1

# 2. 编译部署
.\编译并部署到游戏.ps1

# 3. 验证功能
# 进入游戏 → 开启立绘模式 → 查看日志确认无报错
```

---

## ?? 新增功能

### 1?? 公共接口

```csharp
// 触发姿态动画（3秒，带光圈特效）
panel.TriggerPostureAnimation(
    postureName: "body_arrival",
    effectName: "glitch_circle", 
    duration: 3.0f,
    callback: () => Log.Message("动画结束！")
);

// 停止动画
panel.StopAnimation();
```

### 2?? 动画特性

| 特性 | 说明 |
|------|------|
| **姿态替换** | 完全替代身体层，禁用眼睛/嘴巴动画 |
| **特效叠加** | 最顶层绘制，脉冲 Alpha 效果 |
| **淡入淡出** | 前10%淡入，后10%淡出 |
| **交互禁用** | 动画中禁用 Shift 触摸模式 |
| **呼吸禁用** | 避免与姿态动画冲突 |

---

## ?? 纹理结构

```
Textures/UI/Narrators/Descent/
├── Postures/             # 姿态纹理（1024x1574）
│   ├── body_arrival.png  # 降临姿态
│   └── body_idle.png     # 待机姿态
└── Effects/              # 特效纹理
    ├── glitch_circle.png # 光圈特效
    └── light_burst.png   # 光爆特效
```

---

## ?? 调试日志

```
[FullBodyPortraitPanel] ? 开始姿态动画: body_arrival, 特效: glitch_circle, 时长: 3秒
[FullBodyPortraitPanel] ? 动画已停止
```

---

## ?? 常见问题

### Q1: 编译错误 "找不到 UIFloatingText"
**A:** 文件被意外截断，运行恢复命令：
```powershell
git checkout HEAD -- Source\TheSecondSeat\UI\FullBodyPortraitPanel.cs
.\Apply-Posture-System-v1.6.63.ps1
```

### Q2: 姿态纹理未显示
**A:** 检查：
1. 纹理路径是否正确：`UI/Narrators/Descent/Postures/body_arrival`
2. 纹理尺寸是否为 1024x1574
3. ContentFinder 日志是否有 "未找到" 警告

### Q3: 特效不显示
**A:** 确认：
1. `activeEffect` 参数非空
2. 特效纹理存在于 `UI/Narrators/Descent/Effects/`
3. 特效使用透明通道（RGBA）

---

## ?? 修改文件清单

| 文件 | 修改类型 | 行数变化 |
|------|---------|---------|
| `FullBodyPortraitPanel.cs` | ?? 修改 | +150 |
| `通用姿态系统-重构指南-v1.6.63.md` | ? 新增 | +400 |
| `Apply-Posture-System-v1.6.63.ps1` | ? 新增 | +100 |

---

## ?? 下一步开发

完成本次重构后，可继续实现：

1. **`NarratorDescentSystem.cs`** - 降临系统主控制器
   - 监听事件触发降临
   - 管理降临序列（淡入 → 姿态 → 对话 → 淡出）
   
2. **`DescentAnimationController.cs`** - 动画序列控制
   - 编排多阶段动画
   - 控制镜头聚焦、音效、特效
   
3. **`DescentEffectRenderer.cs`** - 高级特效渲染
   - 粒子系统
   - 屏幕震动
   - 后处理效果

---

## ?? 相关文档

- **完整指南：** `通用姿态系统-重构指南-v1.6.63.md`
- **开发路线图：** `叙事者降临模式-开发路线图-v2.0.0.md`
- **美术资源需求：** `叙事者降临模式-美术资源需求清单-v2.0.0.md`

---

**版本：** v1.6.63  
**最后更新：** 2025年  
**负责人：** The Second Seat 开发团队
