# ?? 性格标签库系统 - 快速参考 v1.6.64

## ? 核心改进

| 旧架构 | 新架构 |
|--------|--------|
| ? C# 硬编码 | ? XML 配置化 |
| ? 无法扩展 | ? Mod 可自由扩展 |
| ? 无本地化 | ? 支持多语言 |
| ? 固定行为 | ? 动态激活 |

---

## ?? 核心文件

```
Defs/PersonalityTagDefs.xml          ← 标签定义库
Source/.../PersonalityTagDef.cs      ← Def 类
Source/.../SystemPromptGenerator.cs  ← 重构加载
Languages/*/Keyed/PersonalityTags_Keys.xml ← 本地化
```

---

## ?? 内置标签

| 标签 | DefName | 好感度 | 特征 |
|------|---------|--------|------|
| 病娇 | Yandere | 60+ | 占有欲、嫉妒 |
| 冰美人 | Kuudere | 60+ | 冷静、零距离 |
| 傲娇 | Tsundere | 40+ | 嘴硬心软 |
| 温柔 | Gentle | 30+ | 呵护、关心 |
| 高傲 | Arrogant | 0+ | 优越感 |
| 活泼 | Energetic | 30+ | 元气满满 |
| 神秘 | Mysterious | 0+ | 隐喻暗示 |

---

## ??? 使用方法

### 1. 添加标签到叙事者

```xml
<NarratorPersonaDef>
  <defName>MyNarrator</defName>
  <personalityTags>
    <li>Kuudere</li>
    <li>Mysterious</li>
  </personalityTags>
</NarratorPersonaDef>
```

### 2. 创建自定义标签

```xml
<PersonalityTagDef>
  <defName>MyTag</defName>
  <label>我的标签</label>
  <minAffinityToActivate>50</minAffinityToActivate>
  <behaviorInstructions>
    <li priority="1">?? **MY MODE:**</li>
    <li priority="2">   - 自定义行为</li>
  </behaviorInstructions>
</PersonalityTagDef>
```

### 3. 本地化标签

```xml
<LanguageData>
  <PersonalityTag.MyTag.Label>我的标签</PersonalityTag.MyTag.Label>
  <PersonalityTag.MyTag.Description>描述文本</PersonalityTag.MyTag.Description>
</LanguageData>
```

---

## ? 快速部署

```powershell
.\Deploy-PersonalityTagLibrary-v1.6.64.ps1
.\编译并部署到游戏.ps1
```

---

## ? 测试清单

- [ ] DefDatabase 加载成功
- [ ] 7个内置标签可见
- [ ] 标签条件激活正常
- [ ] 本地化显示正确
- [ ] System Prompt 生成包含标签指令

---

## ?? 扩展示例

### 组合标签
```xml
<personalityTags>
  <li>Kuudere</li>
  <li>Yandere</li>  <!-- 冷静的病娇 -->
</personalityTags>
```

### 条件激活
```xml
<PersonalityTagDef>
  <defName>MaxAffinityOnly</defName>
  <minAffinityToActivate>95</minAffinityToActivate>
  <maxAffinityToActivate>100</maxAffinityToActivate>
</PersonalityTagDef>
```

### 风格修正
```xml
<dialogueStyleModifiers>
  <emotionalExpression>0.9</emotionalExpression>
  <physicalDirectness>0.95</physicalDirectness>
</dialogueStyleModifiers>
```

---

**状态**: ? 实现完成  
**版本**: v1.6.64
