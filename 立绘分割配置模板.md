# 立绘分割配置模板

## 如何使用

在 `Source/TheSecondSeat/PersonaGeneration/PortraitSplitter.cs` 中修改 `GetPersonaConfig` 方法。

---

## 配置示例

### Cassandra（脖子稍高）
```csharp
case "Cassandra_Classic":
    return new PortraitSplitConfig
    {
        personaName = "Cassandra_Classic",
        splitType = SplitType.Horizontal,
        horizontalSplitY = 0.28f,  // 从顶部28%分割
        featherWidth = 12,         // 12像素羽化
        enableFeathering = true
    };
```

### Phoebe（脖子标准）
```csharp
case "Phoebe_Chillax":
    return new PortraitSplitConfig
    {
        personaName = "Phoebe_Chillax",
        splitType = SplitType.Horizontal,
        horizontalSplitY = 0.30f,  // 从顶部30%分割
        featherWidth = 10,         // 10像素羽化
        enableFeathering = true
    };
```

### Randy（脖子稍低）
```csharp
case "Randy_Random":
    return new PortraitSplitConfig
    {
        personaName = "Randy_Random",
        splitType = SplitType.Horizontal,
        horizontalSplitY = 0.32f,  // 从顶部32%分割
        featherWidth = 10,         // 10像素羽化
        enableFeathering = true
    };
```

### 自定义人格（长脖子）
```csharp
case "CustomPersona_LongNeck":
    return new PortraitSplitConfig
    {
        personaName = "CustomPersona_LongNeck",
        splitType = SplitType.Horizontal,
        horizontalSplitY = 0.35f,  // 脖子更低
        featherWidth = 15,         // 更大羽化
        enableFeathering = true
    };
```

### 自定义人格（短脖子）
```csharp
case "CustomPersona_ShortNeck":
    return new PortraitSplitConfig
    {
        personaName = "CustomPersona_ShortNeck",
        splitType = SplitType.Horizontal,
        horizontalSplitY = 0.25f,  // 脖子更高
        featherWidth = 8,          // 较小羽化
        enableFeathering = true
    };
```

---

## 参数说明

### horizontalSplitY（分割线位置）
```
范围: 0.0 - 1.0（从顶部开始的百分比）

0.20 = 顶部20%  ← 太高，会切割到脸部
0.25 = 顶部25%  ← 稍高
0.28 = 顶部28%  ← Cassandra（推荐）
0.30 = 顶部30%  ← 标准（推荐）
0.32 = 顶部32%  ← Phoebe（推荐）
0.35 = 顶部35%  ← 稍低
0.40 = 顶部40%  ← 太低，会露出服装颈部
```

### featherWidth（羽化宽度）
```
范围: 0 - 30 像素

0px   = 无羽化（生硬切割）?
5px   = 轻微羽化
8px   = 较小羽化
10px  = 标准羽化 ? 推荐
12px  = 较大羽化
15px  = 明显羽化
20px+ = 过度羽化（过渡区域太明显）??
```

### enableFeathering（是否启用羽化）
```
true  = 启用羽化（推荐）?
false = 禁用羽化（不推荐）?
```

---

## 如何确定分割线位置

### 方法 1: 使用预览工具
```csharp
// 在游戏中调用（通过调试窗口或命令）
PortraitSplitter.SaveSplitPreview(texture, "Cassandra_Classic");

// 查看生成的预览图
// 位置: SaveData/TheSecondSeat/Cassandra_Classic_split_preview.png
// 红线显示分割线位置
```

### 方法 2: 手动测量
```
1. 在 Photoshop/CSP 中打开立绘
2. 找到脖子位置的 Y 坐标
3. 计算百分比:
   
   百分比 = Y坐标 / 图片高度
   
   示例（1080x1920 图片）:
   - 脖子位于 Y = 538px
   - 百分比 = 538 / 1920 = 0.28
   - 设置: horizontalSplitY = 0.28f
```

### 方法 3: 参考其他角色
```
如果新角色与 Cassandra 体型相似:
└─ 使用 0.28f

如果与 Phoebe 相似:
└─ 使用 0.32f

如果不确定:
└─ 从 0.30f 开始，逐步调整
```

---

## 调试流程

### Step 1: 设置初始值
```csharp
return new PortraitSplitConfig
{
    horizontalSplitY = 0.30f,  // 从标准值开始
    featherWidth = 10,         // 标准羽化
    enableFeathering = true
};
```

### Step 2: 生成预览
```csharp
PortraitSplitter.SaveSplitPreview(texture, personaName);
```

### Step 3: 查看预览图
```
检查红线是否在脖子位置:
- 太高？增加 horizontalSplitY (0.30 → 0.32)
- 太低？减少 horizontalSplitY (0.30 → 0.28)
```

### Step 4: 微调
```csharp
// 每次调整 0.01 - 0.02
0.30 → 0.31 → 0.32 → ...

// 直到红线对准脖子
```

### Step 5: 测试羽化
```csharp
// 调整羽化宽度
featherWidth = 10  → 12 → 15

// 查看过渡是否自然
```

---

## 特殊场景配置

### 场景 1: 高领服装
```csharp
// 高领服装可能需要更低的分割线
horizontalSplitY = 0.35f,  // 避免切到领子
featherWidth = 15          // 更大羽化，平滑高领边缘
```

### 场景 2: 露肩服装
```csharp
// 露肩服装需要更高的分割线
horizontalSplitY = 0.25f,  // 在肩膀以上
featherWidth = 12          // 标准羽化
```

### 场景 3: 无脖子角色（Q版）
```csharp
// Q版角色头大身小，分割线更靠上
horizontalSplitY = 0.40f,  // 头部占比大
featherWidth = 8           // 较小羽化
```

### 场景 4: 长颈角色
```csharp
// 脖子很长的角色
horizontalSplitY = 0.20f,  // 分割线在脖子中间
featherWidth = 20          // 更大羽化，覆盖整个脖子
```

---

## 完整配置代码

```csharp
private static PortraitSplitConfig GetPersonaConfig(string personaName)
{
    switch (personaName)
    {
        // 原版角色
        case "Cassandra_Classic":
            return new PortraitSplitConfig
            {
                personaName = personaName,
                splitType = SplitType.Horizontal,
                horizontalSplitY = 0.28f,
                featherWidth = 12,
                enableFeathering = true
            };
            
        case "Phoebe_Chillax":
            return new PortraitSplitConfig
            {
                personaName = personaName,
                splitType = SplitType.Horizontal,
                horizontalSplitY = 0.32f,
                featherWidth = 10,
                enableFeathering = true
            };
            
        case "Randy_Random":
            return new PortraitSplitConfig
            {
                personaName = personaName,
                splitType = SplitType.Horizontal,
                horizontalSplitY = 0.30f,
                featherWidth = 10,
                enableFeathering = true
            };
        
        // 自定义角色
        case "YourCustomPersona":
            return new PortraitSplitConfig
            {
                personaName = personaName,
                splitType = SplitType.Horizontal,
                horizontalSplitY = 0.30f,  // ← 修改这里
                featherWidth = 10,         // ← 修改这里
                enableFeathering = true
            };
        
        // 默认配置
        default:
            return new PortraitSplitConfig
            {
                personaName = personaName,
                splitType = SplitType.Horizontal,
                horizontalSplitY = 0.30f,
                featherWidth = 10,
                enableFeathering = true
            };
    }
}
```

---

## 测试清单

配置完成后，请验证：

- [ ] 分割线在脖子位置（不切割脸部）
- [ ] 羽化边缘平滑自然
- [ ] 无明显切割线
- [ ] 表情差分头部正确
- [ ] 服装差分身体正确
- [ ] 表情+服装组合无冲突

---

**提示**: 
1. 从标准值（0.30, 10px）开始
2. 使用预览工具查看分割线
3. 微调直到完美对齐脖子
4. 测试表情和服装组合效果
