# 降临系统通用化 - 快速参考 v1.6.63

## ? 已完成

###  1. NarratorPersonaDef.cs - 配置字段
```csharp
// 8个新字段
public string descentPawnKind = "";           // PawnKindDef名称
public string descentSkyfallerDef = "";       // ThingDef名称（空投舱）
public string companionPawnKind = "";         // 伴随生物
public string descentPosturePath = "";        // 姿态纹理
public string descentEffectPath = "";         // 特效纹理
public string descentSound = "";              // 音效
public string descentLetterLabel = "";        // 信件标题
public string descentLetterText = "";         // 信件内容
```

### 2. NarratorDescentSystem.cs - 完全重写
- ? **核心原则：只读配置，不认人**
- 所有 DefName 从 `NarratorPersonaDef` 读取
- 禁止硬编码

**主要API：**
```csharp
NarratorDescentSystem.Instance.TriggerDescent(isHostile: false);
```

## ?? 当前编译错误

**错误 1：** `PortraitOverlaySystem.GetPortraitPanel()` 不存在

**解决方案：** 检查 `PortraitOverlaySystem` 的实际API

**错误 2：** `SoundStarter` 未定义

**解决方案：** 已修复，使用 `SoundStarter.PlayOneShot`

## ?? 待办事项

1. 修复 `PortraitOverlaySystem.GetPortraitPanel()` 调用
2. 完成编译验证
3. 创建 Sideria 降临配置示例
4. 测试通用化系统

## ?? 预期使用方式

```xml
<!-- Sideria 降临配置 -->
<TheSecondSeat.PersonaGeneration.NarratorPersonaDef>
  <defName>Sideria_Descent</defName>
  
  <descentPawnKind>Sideria_Descent</descentPawnKind>
  <companionPawnKind>Sideria_Dragon</companionPawnKind>
  <descentPosturePath>body_arrival</descentPosturePath>
  <descentEffectPath>glitch_circle</descentEffectPath>
  <descentSound>Thunder_OnMap</descentSound>
</TheSecondSeat.PersonaGeneration.NarratorPersonaDef>
```

**版本：** v1.6.63  
**状态：** 代码完成90%，待修复编译错误  
**日期：** 2025年12月20日
